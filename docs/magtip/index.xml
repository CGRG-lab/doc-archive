<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>doc-archive – MagTIP</title><link>https://CGRG-lab.github.io/doc-archive/docs/magtip/</link><description>Recent content in MagTIP on doc-archive</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><atom:link href="https://CGRG-lab.github.io/doc-archive/docs/magtip/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Introduction and Tutorial</title><link>https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_tutorial/</link><pubDate>Tue, 03 May 2022 00:00:00 +0000</pubDate><guid>https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_tutorial/</guid><description>
&lt;!--
```
using HypertextTools
cd("doc_tutorial")
lazyhugo();
cp2content(raw"D:\GoogleDrive\Sites\CGRG\doc-archive\content\en\docs\magtip\doc_tutorial")
``` -->
&lt;h2 id="introduction">Introduction&lt;/h2>
&lt;p>MagTIP calculates the TIP (Time of Increased Probability) of earthquakes basing on the geomagnetic records of Central Weather Bureau of Taiwan.
The algorithm allows for the optimization of the model parameters, and gives the overall TIP (named joint-station TIP).
The probability of capturing a target event in space and time can be derived based on the joint-station TIP, by considering the results from a large set of randomly permuted of model parameters simultaneously.&lt;/p>
&lt;p>In the traditional TIP forecasting, the type and the number of input data have to be uniquely formatted otherwise re-training according to the new format is required.
As a result, either the conversion for fitting new data to old format (where some information must lose), or an extra waiting period (e.g. 7 years) for re-training models with new data, is required.
The time scale of the evolution of the underground dynamical system is generally thought to be large, hence data collected from old stations are precious. For being able to fully utilizing both the data from the most modern instruments and older sensors, the project of this year aims for the multivariate MagTIP forecasting system.&lt;/p>
&lt;p>The newest multivariate MagTIP forecasting system not only supports three-component and one-component geomagnetic signals simultaneously, but also allows additional earthquake-relevant time series to be involved in calculating TIP.&lt;/p>
&lt;h2 id="environment">Environment&lt;/h2>
&lt;p>Type &lt;code>license('inuse')&lt;/code> or &lt;code>ver&lt;/code> to see all the toolboxes you have.&lt;/p>
&lt;div class="markdown">&lt;p>&lt;strong>MATLAB Version&lt;/strong>: 9.11.0.1809720 &amp;#40;R2021b&amp;#41; Update 1 &lt;strong>Operating System&lt;/strong>: Microsoft Windows 10 企業版 Version 10.0 &amp;#40;Build 19044&amp;#41; &lt;strong>Java Version&lt;/strong>: Java 1.8.0_202-b08 with Oracle Corporation Java HotSpot&amp;#40;TM&amp;#41; 64-Bit Server VM mixed mode&lt;/p>
&lt;p>&lt;strong>Toolbox in-use&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>MATLAB Version 9.11 &amp;#40;R2021b&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>Mapping Toolbox Version 5.2 &amp;#40;R2021b&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>Parallel Computing Toolbox Version 7.5 &amp;#40;R2021b&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>Signal Processing Toolbox Version 8.7 &amp;#40;R2021b&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>Statistics and Machine Learning Toolbox Version 12.2 &amp;#40;R2021b&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;p>The main functions of MagTIP take directories that contains necessary files as input arguments, and all output variables are saved in another directory as &amp;ldquo;.mat&amp;rdquo; files.
In this document, the input/output variable that contains the information of the path to a directory (i.e., a folder) is prefixed by &lt;code>dir_&lt;/code>; for example, &lt;code>dir_data&lt;/code> is the directory for the formatted geomagnetic data, and &lt;code>dir_stat&lt;/code> is the directory for statistic indices.
The &lt;code>dir_&lt;/code>-prefixed variables are each a sequence of characters being something like &lt;code>'D:\MagTIP-2022\output_var\StatisticIndex'&lt;/code>.&lt;/p>
&lt;h3 id="the-sample-script-for-everything">The Sample Script for Everything&lt;/h3>
&lt;p>There is a script &lt;strong>&amp;ldquo;demo/demo_script.m&amp;rdquo;&lt;/strong> contains the sample codes of the whole process; you can easily make everything set and go through the entire MagTIP procedures following the steps below:&lt;/p>
&lt;ul>
&lt;li>switch current directory to the folder named &amp;ldquo;MagTIP-2022&amp;rdquo;&lt;/li>
&lt;li>run section(s) in the script&lt;/li>
&lt;/ul>
&lt;p>In the beginning (the first three sections), you will see several pop-out windows for selecting the directory of geomagnetic data (&lt;code>dir_data&lt;/code>) and loading the toolbox (&lt;code>dir_toolbox&lt;/code>).
Select the right folders as instructed, and they will be automatically added to path and be ready to use.&lt;/p>
&lt;h3 id="inputoutput-directories">Input/Output Directories&lt;/h3>
&lt;p>Assigning directories for input/output data or variables is necessary before running any application.
For example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-matlab" data-lang="matlab">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_catalog&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;data\spreadsheet&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">% directory of event catalog &amp;amp; station location&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_data&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;data\geomag_1&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">% directory of geomagnetic timeseries&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_stat&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;output_var\StatisticIndex&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">% directory of statistic indices&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_tsAIN&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;output_var\tsAIN&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">% directory for storing anomaly index number (AIN)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_molchan&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;output_var\Molchan&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">% directory for storing Molchan scores&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_jointstation&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;output_var\JointStation&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">% directory for the time series of EQK, TIP and probability&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This can be done alternatively using &lt;code>mkdir_default()&lt;/code> to create the set of empty folders with each folder name never repeats.
That is, the code chunk above is equivalent to&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-matlab" data-lang="matlab">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_catalog&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;data\spreadsheet&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_data&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;data\geomag_1&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#000">dir_stat&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dir_tsAIN&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dir_molchan&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dir_jointstation&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000">mkdir_default&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;output_var&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here is an overview of this default directory structure:
&lt;img src="dirtree.svg" alt="">&lt;/p>
&lt;!-- `LaTeX Error: Cannot determine size of graphic in ../fig/dirtree.svg (no Bound ingBox).` when doctype is "md2pdf" -->
&lt;p>You can create this directory structure manually by adding new folders using your OS&amp;rsquo;s interface.
You can also assign the &lt;code>dir_&lt;/code>-prefixed variables by using &lt;code>dirselectassign(...)&lt;/code>, where windows pop out for selecting existing directory.
For more information, see &amp;ldquo;demo_script.m&amp;rdquo; and &amp;ldquo;dirselectassign.m&amp;rdquo;.&lt;/p>
&lt;p>&lt;strong>⚠Notice:&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;code>dir_spreadsheet&lt;/code> must contain &lt;code>catalog.csv&lt;/code> and &lt;code>station_location.csv&lt;/code>, with the first row (column names) being &amp;lsquo;code&amp;rsquo;, &amp;lsquo;format&amp;rsquo;, &amp;lsquo;Lon&amp;rsquo;, &amp;lsquo;Lat&amp;rsquo; for &lt;code>station_location.csv&lt;/code>, and &amp;rsquo;time&amp;rsquo;, &amp;lsquo;Lon&amp;rsquo;, &amp;lsquo;Lat&amp;rsquo;, &amp;lsquo;Depth&amp;rsquo;, and &amp;lsquo;Mag&amp;rsquo; for &lt;code>catalog.csv&lt;/code>.&lt;/li>
&lt;li>The order of column names can be arbitrarily arranged, but the strings have to be exactly the same as above.&lt;/li>
&lt;li>Geomagnetic time series in &lt;code>dir_data&lt;/code> should be converted to the standard format. For more information, see &lt;code>conv_geomagdata&lt;/code>.&lt;/li>
&lt;/ol>
&lt;h2 id="prepare-your-data">Prepare Your Data&lt;/h2>
&lt;h3 id="format-of-station-list-and-earthquake-catalog">Format of Station list and Earthquake Catalog&lt;/h3>
&lt;p>The &lt;code>station_location.csv&lt;/code> specifies the location of every station;
here is an example for &lt;code>station_location.csv&lt;/code>:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>code&lt;/th>
&lt;th>format&lt;/th>
&lt;th>Lon&lt;/th>
&lt;th>Lat&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>MS&lt;/td>
&lt;td>馬仕&lt;/td>
&lt;td>120.633&lt;/td>
&lt;td>22.61089&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>TW&lt;/td>
&lt;td>灣丘&lt;/td>
&lt;td>120.5286&lt;/td>
&lt;td>23.18502&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&amp;hellip;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>XC&lt;/td>
&lt;td>新城&lt;/td>
&lt;td>121.6095&lt;/td>
&lt;td>24.0383&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SM&lt;/td>
&lt;td>日月潭&lt;/td>
&lt;td>120.9076&lt;/td>
&lt;td>23.881&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>The &lt;code>catalog.csv&lt;/code> is the catalog covering at least the entire range of all training phases;
here is an example for &lt;code>catalog.csv&lt;/code>:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>time&lt;/th>
&lt;th>Lon&lt;/th>
&lt;th>Lat&lt;/th>
&lt;th>Depth&lt;/th>
&lt;th>Mag&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2020/8/10 06:41&lt;/td>
&lt;td>121.59&lt;/td>
&lt;td>23.81&lt;/td>
&lt;td>29.86&lt;/td>
&lt;td>3.41&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2020/8/10 06:29&lt;/td>
&lt;td>120.57&lt;/td>
&lt;td>22.18&lt;/td>
&lt;td>43.54&lt;/td>
&lt;td>3.02&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2020/8/10 06:14&lt;/td>
&lt;td>121.7&lt;/td>
&lt;td>22.17&lt;/td>
&lt;td>124.78&lt;/td>
&lt;td>4.13&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&amp;hellip;&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Also see &lt;a href="https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_library/#station-list-formatting-checkstation">checkstation.m&lt;/a> and &lt;a href="https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_library/#earthquake-catalog-formatting-checkcatalog">checkcatalog.m&lt;/a>.&lt;/p>
&lt;h3 id="standard-data-format">Standard data format&lt;/h3>
&lt;p>All records should be converted/transformed into the formatted matfiles.
The formatted file name is generated via &lt;code>standarddataname&lt;/code>, where&lt;/p>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;fname&amp;#93; &amp;#61; standarddataname&amp;#40;stnm, dtstr, type_j&amp;#41;&lt;/code> returns the file name of the standard data format. For example, &lt;code>standarddataname&amp;#40;&amp;#39;HUAL&amp;#39;, &amp;#39;20120202&amp;#39;, &amp;#39;GEMS0&amp;#39;&amp;#41;&lt;/code> returns &lt;code>stn&amp;#91;HUAL&amp;#93;dt&amp;#91;20120202&amp;#93;type&amp;#91;GEMS0&amp;#93;.mat&lt;/code>.&lt;/p>
&lt;/div>
&lt;p>The formatted matfile should contain only 1 field where the field name can be arbitrarily chosen. Saying the field to be &lt;code>M&lt;/code>, &lt;code>M&lt;/code> has to be a matrix where the column indices to time and data are assigned by function &lt;code>fmt.colindex2data&lt;/code> depending on the type of the data. See &lt;a href="../doc_library/#format">Library/Format&lt;/a> for more information.&lt;/p>
&lt;h4 id="format-of-geomagnetic-data">Format of Geomagnetic Data&lt;/h4>
&lt;p>All original files of geomagnetic timeseries have to be converted to the new format before any function that takes &lt;code>dir_data&lt;/code> as an input argument.
You can convert the data by simply applying:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-matlab" data-lang="matlab">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">conv_geomagdata&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_originalfiles&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dir_data&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In which,&lt;/p>
&lt;ul>
&lt;li>&lt;code>conv_geomagdata&lt;/code> takes two required input argument. The first is the directory of original files, and the second is the output folder for the new files.&lt;/li>
&lt;li>The naming of original files should be &amp;ldquo;yyyymmdd.StationCode&amp;rdquo; or &amp;ldquo;yyyymmddHH.StationCode&amp;rdquo;. For example, &amp;ldquo;20150202.MS&amp;rdquo; and &amp;ldquo;2015020223.MS&amp;rdquo;, respectively.&lt;/li>
&lt;li>The naming criteria for new files is &amp;ldquo;stn[StationCode]dt[yyyymmdd]type[DataType].mat&amp;rdquo;. For example, &amp;ldquo;stn[MS]dt[20150202]type[full].mat&amp;rdquo; is the formatted geomagnetic data converted from &amp;ldquo;20150202.MS&amp;rdquo;, which is a one-component time series.&lt;/li>
&lt;li>The process of conversion may take very long if the number of files to be converted is large. Use the option &lt;code>'ContinueFromLast'&lt;/code> and &lt;code>'FilterByDatetime'&lt;/code> to avoid repeatedly converting the files that have already been converted before.&lt;/li>
&lt;li>For more information, see &amp;ldquo;conv_geomagdata.m&amp;rdquo;.&lt;/li>
&lt;/ul>
&lt;h2 id="the-main-process">The Main Process&lt;/h2>
&lt;p>After all data are prepared (those in &lt;code>dir_data&lt;/code> and &lt;code>dir_spreadsheet&lt;/code>), you can run the whole forecasting process simply with:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-matlab" data-lang="matlab">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">statind&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_data&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_stat&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span> &lt;span style="color:#8f5902;font-style:italic">% For multi-threading, use statind_parfor(...) &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">anomalyind&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_stat&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_tsAIN&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">molscore&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_tsAIN&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_catalog&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_molchan&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span> &lt;span style="color:#8f5902;font-style:italic">% For multi-threading, use molscore_parfor(...)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">molscore3&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_tsAIN&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_molchan&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_catalog&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_jointstation&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span> &lt;span style="color:#8f5902;font-style:italic">%For multi-threading, use molscore3_parfor(...) &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In which, &lt;code>statind&lt;/code> calculates specific statistical quantities of each day; &lt;code>anomalyind&lt;/code> calculates anomaly index according to different $A_\text{thr}$ threshold; &lt;code>molscore&lt;/code> gives optimized models; and &lt;code>molscore3&lt;/code> use optimized models to calculate probability forecasts.&lt;/p>
&lt;h2 id="visualization-of-the-results">Visualization of the Results&lt;/h2>
&lt;p>There are several tools provided for visualizing the result. For detailed information about these tools, please refer to the &lt;a href="../doc_library/#plotting">Library/Tools/Plotting&lt;/a>.&lt;/p>
&lt;p>There is also a script &lt;strong>&amp;ldquo;demo/demo_visualization.m&amp;rdquo;&lt;/strong>; you can easily obtain plots of the results following the steps below:&lt;/p>
&lt;ul>
&lt;li>switch current directory to the folder named &amp;ldquo;MagTIP-2022&amp;rdquo;&lt;/li>
&lt;li>run section(s) in the script&amp;quot;&lt;/li>
&lt;/ul>
&lt;h3 id="probability-forecast">Probability Forecast&lt;/h3>
&lt;p>&lt;code>plotProbability&lt;/code> visualizes the probability of the calculated results (which is stored in &lt;code>dir_jointstation&lt;/code> in default), with options for whether to plot epicenters of target events (目標地震) and for specifying the date time to plot, as an example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-matlab" data-lang="matlab">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_prob&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000">fullfile&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_jointstation&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;png&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;prob&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dates2plot&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#000">datetime&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2020&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">):&lt;/span>&lt;span style="color:#000">calmonths&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">6&lt;/span>&lt;span style="color:#000;font-weight:bold">):&lt;/span>&lt;span style="color:#000">datetime&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2021&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">)];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">plotProbability&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_jointstation&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_catalog&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_prob&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#8f5902;font-style:italic">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#39;TimeRange&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dates2plot&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;PlotEpicenter&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;all&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="plotProb_ex1.png" alt="">&lt;/p>
&lt;blockquote>
&lt;p>In this figure, the triangle denotes the location of station; circle(s) around each station denote the maximum and minimum range of detection ($R_C$) of the models that are responsible for calculating the TIPs; the filled color of the triangle denotes the ratio of valid models of the day; and hollow triangle denotes the station that cannot provide TIP for the day.&lt;/p>
&lt;/blockquote>
&lt;h3 id="the-matching-diagram">The Matching Diagram&lt;/h3>
&lt;p>&lt;code>plotEQKTIP1&lt;/code> provides the 1-dimensional match diagram of a specific model.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-matlab" data-lang="matlab">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir_png&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000">fullfile&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_molchan&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;png&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;EQKTIP&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">plotEQKTIP1&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dir_tsAIN&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_molchan&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_catalog&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">dir_png&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#8f5902;font-style:italic">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#39;ForecastingPhase&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#000">calyears&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;ShowTrainingPhase&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;Rank&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#8f5902;font-style:italic">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#39;ForceMagnitude&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0.5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;scatter&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="plotEQKTIP_ex1.png" alt="">&lt;/p>
&lt;blockquote>
&lt;p>In this figure, the match diagram of EQK and TIP defined by the model of first rank is demonstrated. The intervals of black color denotes the days where there is no data in $T_\text{obs}$ at all (i.e. this model is invalid at these time) and hence TIP cannot be calculated.&lt;/p>
&lt;/blockquote></description></item><item><title>Docs: Library</title><link>https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_library/</link><pubDate>Tue, 03 May 2022 00:00:00 +0000</pubDate><guid>https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_library/</guid><description>
&lt;!--
`cd` to the folder where there is `.jmd`, and
```
using HypertextTools
cd("doc_library")
lazyhugo();
cp2content(raw"D:\GoogleDrive\Sites\CGRG\doc-archive\content\en\docs\magtip\doc_library")
``` -->
&lt;!-- # Documentation -->
&lt;p>&lt;strong>⚠Warning:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Please don&amp;rsquo;t assign undocumented name-value pair parameters to the functions. For example, &lt;code>'CreateInfoOnly'&lt;/code> and &lt;code>'InParforLoop'&lt;/code>, which are preserved for parallel computing, and you will never need to set them manually.&lt;/li>
&lt;/ul>
&lt;h2 id="main-functions">Main Functions&lt;/h2>
&lt;p>There are roughly four stages in the MagTIP forecasting process:&lt;/p>
&lt;ol>
&lt;li>the calculation of statistical index&lt;/li>
&lt;li>the calculation of anomaly index number according to 1.&lt;/li>
&lt;li>the calculation of TIP and the Molchan score according to 2.&lt;/li>
&lt;li>probability forecasts according to 2. and 3.&lt;/li>
&lt;/ol>
&lt;p>The four stages is wrapped by four functions with keyword options that we can customize the parameters related to model optimization and probability forecast.
The four main functions are wrapper functions for routine training and forecasting process. As follow:&lt;/p>
&lt;h3 id="data-conversion">Data Conversion&lt;/h3>
&lt;h4 id="conv_geomagdata">&lt;code>conv_geomagdata&lt;/code>&lt;/h4>
&lt;div class="markdown">&lt;p>The original geomagnetic data &amp;#40;which are those in &amp;quot;.csv&amp;quot; format being something like &amp;quot;2008010300.KM&amp;quot; or &amp;quot;20190307.LY&amp;quot;&amp;#41; should be converted to a standard format before any calculation. &lt;code>conv_geomagdata&amp;#40;dir_originalfiles, dir_data&amp;#41;&lt;/code> read original data in &lt;code>dir_originalfiles&lt;/code> and save them in the standard format at the directory &lt;code>dir_data&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Keyword Argument:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;ContinueFromLast&amp;#39;: Default is &lt;code>false&lt;/code>. If &lt;code>true&lt;/code>, it compares the names of all old files in the &lt;code>dir_originalfiles&lt;/code> and the new files in &lt;code>dir_data&lt;/code> before conversion to avoid files that are already being converted to be converted again. This additional procedure may take several hours depending on the size of database; a more efficient way for avoiding repeated processing is to manually specify &amp;#39;FilterByDatetime&amp;#39;. See below.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;FilterByDatetime&amp;#39;: Only convert the files in the assigned time range&amp;#40;s&amp;#41;. It supports: &lt;/p>
&lt;ul>
&lt;li>&lt;p>A datetime. For example, when &lt;code>&amp;#39;FilterByDatetime&amp;#39;, datetime&amp;#40;2010,10,10&amp;#41;&lt;/code>, only files with time tag being or after 2010-Oct-10 will be converted.&lt;/p>
&lt;/li>
&lt;li>&lt;p>N by 2 datetime array, for example, &lt;/p>
&lt;pre>&lt;code>&amp;#39;FilterByDatetime&amp;#39;, &amp;#91;datetime&amp;#40;2009,12,10&amp;#41;, datetime&amp;#40;2010,10,10&amp;#41;;...
datetime&amp;#40;2013,12,10&amp;#41;, datetime&amp;#40;2017,10,10&amp;#41;&amp;#93;;&lt;/code>&lt;/pre>
&lt;p>, only the files in the two time ranges &amp;#91;2009-Dec-10, 2010-Oct-10&amp;#93; and &amp;#91;2013-Dec-10, 2017-Oct-10&amp;#93; will be converted; ohterwise, ignored.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Test&amp;#39;: It take only the assigned ratio &amp;#40;0-1&amp;#41; of data &amp;#40;files&amp;#41; in the directory &lt;code>dir_originalfiles&lt;/code>. The files are randomly chosen. This option should only be applied when you want to test your code for reducing the overall computing time. Default is 0 &amp;#40;when the assigned value for &amp;#39;Test&amp;#39; is &amp;#36;\leq 0&amp;#36; or &amp;#36;\geq 1&amp;#36;, there is no reduction in the data list&amp;#41;.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>NOTICE:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>Files in the original format must be uniquely named as &amp;#39;20200101.HC&amp;#39; or &amp;#39;2020010109.HC&amp;#39; for example.&lt;/p>
&lt;/li>
&lt;li>&lt;p>If not uniquely named, such as &amp;#39;..\HC\20200101.txt&amp;#39;, &amp;#39;..\CS\20200101.txt&amp;#39;, the second one will be regarded as a duplicated file and be moved out to an alternative folder &amp;#40;&lt;code>dir_alt&lt;/code>&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>every file should have its extension as the code of the corresponding station, e.g. &amp;#39;20200101.HC&amp;#39; is correct; &amp;#39;20200101.txt&amp;#39; is not valid and an error will occur.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h4 id="conv_gemsdata">&lt;code>conv_gemsdata&lt;/code>&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>conv_gemsdata&amp;#40;dir_gems, saveto, dir_catalog&amp;#41;&lt;/code> read original GEMS&amp;#39;s data &amp;#40;e.g., &amp;quot;2012&lt;em>02&lt;/em>07&lt;em>16&lt;/em>45&lt;em>00.dat&amp;quot;&amp;#41; in &amp;#96;dir&lt;/em>gems&amp;#96;, merge and convert them to the standard format for MagTIP.&lt;/p>
&lt;p>Also see &lt;code>&amp;quot;read_gemsdata.m&amp;quot;&lt;/code>. &lt;strong>Example&lt;/strong>:&lt;/p>
&lt;pre>&lt;code class="language-matlab">dir_gems &amp;#61; &amp;#39;g:\GEMSdat\&amp;#39;;
&amp;#37; where the individual data locates in for example:
&amp;#37; &amp;#39;g:\GEMSdat\em10\REC\Y2012\M02\D07\2012_02_07_16_45_00.dat&amp;#39;
saveto &amp;#61; &amp;#39;d:\Data&amp;#39;;
dir_catalog &amp;#61; &amp;#37; for obtaining the station information &amp;#40;&amp;quot;station_location.mat&amp;quot;&amp;#41;;
conv_gemsdata&amp;#40;dir_gems, saveto, dir_catalog&amp;#41;;&lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="data-preprocessing">Data Preprocessing&lt;/h3>
&lt;div class="markdown">&lt;p>Hint: it has to contain importdata TODO: under construction&lt;/p>
&lt;p>&lt;code>M_prp &amp;#61; no&amp;#40;fpath&amp;#41;&lt;/code> does no preprocessing, loads and returns the data of &lt;code>fpath&lt;/code> in the form of matrix.&lt;/p>
&lt;p>Other functions might also depends on &lt;code>no&lt;/code>. For example, &lt;code>prpfunctions&lt;/code> is dependent on &lt;code>no&lt;/code> to get the directory of all functions for preprocessing. &lt;/p>
&lt;/div>
&lt;h3 id="statistical-index-calculation-statind">Statistical Index Calculation (&lt;code>statind&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>statind&amp;#40;dir_data,dir_output&amp;#41;&lt;/code> calculate daily statistics &amp;#40;a statistical quantity as an index of the day&amp;#41; of the daily timeseries in &lt;code>dir_data&lt;/code>. The output variables are stored in &lt;code>dir_output&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Example&lt;/strong>:&lt;/p>
&lt;pre>&lt;code class="language-matlab">statind&amp;#40;dir_data,dir_output,&amp;#39;StatName&amp;#39;,&amp;#39;S&amp;#39;,&amp;#39;StatFunction&amp;#39;,@skewness, &amp;#39;Preprocess&amp;#39;, &amp;#123;&amp;#39;ULF_A&amp;#39;,&amp;#39;ULF_B&amp;#39;&amp;#125;&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>In which, &lt;code>dir_data&lt;/code> is the directory for the time series in the standard format; &lt;code>dir_output&lt;/code> is the &lt;code>dir_stat&lt;/code> mentioned before.&lt;/p>
&lt;p>&lt;strong>Keyword Arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>&amp;#39;StatName&amp;#39;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;p>The abbreviations for the name of statistical indices. They can be arbitrarily defined but have to be the same number of elements as that of &lt;code>&amp;#39;StatFunction&amp;#39;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>&amp;#123;&amp;#39;S&amp;#39;,&amp;#39;K&amp;#39;&amp;#125;&lt;/code> &amp;#40;for Skewness and Kurtosis&amp;#41;.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&lt;code>&amp;#39;StatFunction&amp;#39;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;p>The function handle for calculating statistical index.&lt;/p>
&lt;/li>
&lt;li>&lt;p>It has to be of the same number of elements as that of &lt;code>&amp;#39;StatName&amp;#39;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>&amp;#123;@skewness,@kurtosis&amp;#125;&lt;/code> for calling the &lt;code>skewness&amp;#40;&amp;#41;&lt;/code> and &lt;code>kurtosis&amp;#40;&amp;#41;&lt;/code> functions.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&lt;code>&amp;#39;Preprocess&amp;#39;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;p>Apply filter&amp;#40;s&amp;#41; to time series loaded from &lt;code>dir_data&lt;/code>. Generally applying a filter very largely increase the computing time, so you may consider &lt;code>&amp;#39;SavePreprocessedData&amp;#39;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>&amp;#123;&amp;#39;no&amp;#39;&amp;#125;&lt;/code>, where no filter will be applied.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Supported arguments are &lt;code>&amp;#39;no&amp;#39;&lt;/code>, &lt;code>&amp;#39;ULF_A&amp;#39;&lt;/code> &amp;#40;a band pass filter of frequency range &lt;code>&amp;#91;0.001 0.003&amp;#93;&lt;/code> Hz&amp;#41;, &lt;code>&amp;#39;ULF_B&amp;#39;&lt;/code> &amp;#40;&lt;code>&amp;#91;0.001 0.01&amp;#93;&lt;/code> Hz&amp;#41;, and &lt;code>&amp;#39;ULF_C&amp;#39;&lt;/code> &amp;#40;&lt;code>&amp;#91;0.001 0.1&amp;#93;&lt;/code> Hz&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Use &lt;code>prpfunctions&amp;#40;&amp;#41;&lt;/code> to list all available preprocessing functions.&lt;/p>
&lt;/li>
&lt;li>&lt;p>If multiple filters are applied, for example &lt;code>&amp;#123;&amp;#39;no&amp;#39;, &amp;#39;ULF_A&amp;#39;&amp;#125;&lt;/code>, then two sets of result according to no-filter data and ULF_A band passed data are going to be produced. &lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&lt;code>&amp;#39;SavePreprocessedData&amp;#39;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;p>Save the preprocessed data to an alternative folder. Their directory is parallel to that of no-filter data.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&lt;code>&amp;#39;FilterByDatetime&amp;#39;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;p>It should be a two element datetime array.&lt;/p>
&lt;/li>
&lt;li>&lt;p>If applied, all files with date time tag not in the range will be ignored.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>&amp;#91;datetime&amp;#40;0001,1,1&amp;#41;, datetime&amp;#40;2999,12,31&amp;#41;&amp;#93;&lt;/code>, resulting in no data selection by date time tag.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&lt;code>&amp;#39;SkipExist&amp;#39;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;p>Set it &lt;code>true&lt;/code> to skip calculations if in the current loop a file in &lt;code>dir_stat&lt;/code> of the&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>same &lt;code>&amp;#39;stn&amp;#39;&lt;/code> and &lt;code>&amp;#39;prp&amp;#39;&lt;/code> already exists.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;ul>
&lt;li>The output directory and data structure is:
&lt;img src="struct_stat.png" alt="">&lt;/li>
&lt;/ul>
&lt;div class="markdown">&lt;p>&lt;code>statind_parfor&lt;/code> is the parallel computing version of &lt;code>statind&lt;/code>, it takes the same input arguments and keyword options as &lt;code>statind&lt;/code>.&lt;/p>
&lt;/div>
&lt;h3 id="anomaly-index-number-calculation-anomalyind">Anomaly Index Number Calculation (&lt;code>anomalyind&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>anomalyind&amp;#40;dir_stat,dir_output&amp;#41;&lt;/code> calculates anomaly index number &amp;#40;AIN&amp;#41; according to a list of &amp;#36;A_\text&amp;#123;thr&amp;#125;&amp;#36;; &lt;code>dir_out&lt;/code> is where the output variables stored. &lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;pre>&lt;code>anomalyind&amp;#40;dir_stat,dir_tsAIN&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>&lt;strong>Keyword Arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>&amp;#39;AthrList&amp;#39;&lt;/code>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>the list of &amp;#36;A_\text&amp;#123;thr&amp;#125;&amp;#36; &amp;#40;the multiplier of the median value of the statistical indices within the moving time window&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>default is &lt;code>&amp;#91;1:10&amp;#93;&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&lt;code>&amp;#39;MovingWindow&amp;#39;&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;p>the moving-window length for calculating the median value mentioned above&lt;/p>
&lt;/li>
&lt;li>&lt;p>default is &lt;code>1000&lt;/code> &amp;#40;days&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Input and output:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>anomalyind&lt;/code> takes the statistic index output from &lt;code>statind&lt;/code> by loading them from &lt;code>dir_stat&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>The calculated anomaly index is saved in &lt;code>dir_tsAIN&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;ul>
&lt;li>The output directory and data structure is:
&lt;img src="struct_tsAIN.png" alt="">&lt;/li>
&lt;/ul>
&lt;h3 id="tip-and-molchan-score-calculation-molscore">TIP and Molchan Score Calculation (&lt;code>molscore&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>molscore&amp;#40;dir_tsAIN,dir_catalog,dir_molchan&amp;#41;&lt;/code> is responsible for single station&amp;#39;s TIP &amp;amp; Molchan score calculation. &lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;pre>&lt;code>dir_catalog &amp;#61; &amp;#39;\MagTIP-2021\spreadsheet&amp;#39;;
dir_tsAIN &amp;#61; &amp;#39;\MagTIP-2021\output_var\tsAIN-J13-TZ2&amp;#39;;
dir_molchan &amp;#61; &amp;#39;\MagTIP-2021\output_var\MolchanScore-J13-TZ2&amp;#39;;
molscore&amp;#40;dir_tsAIN,dir_catalog,dir_molchan&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>&lt;strong>Keyword Arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;TrainingPhase&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>Assigns a &amp;#40;set of&amp;#41; training phase&amp;#40;s&amp;#41;. It should be of type &lt;code>&amp;#39;calendarDuration&amp;#39;&lt;/code>, &lt;code>&amp;#39;duration&amp;#39;&lt;/code>, an N by 2 array of &lt;code>&amp;#39;datetime&amp;#39;&lt;/code>, or an N by 2 cell array, where N is the number of the training phases. If given an N by 2 array specifying N training phases, then N sets of results will be produced separately, with output format being &lt;code>&amp;#39;&amp;#91;MolScore&amp;#93;stn&amp;#91;&amp;#37;x&amp;#93;ID&amp;#91;&amp;#37;s&amp;#93;prp&amp;#91;&amp;#37;s&amp;#93;dt&amp;#91;&amp;#37;s-&amp;#37;s&amp;#93;.mat&amp;#39;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>For example, a 4 by 2 datetime array &lt;code>reshape&amp;#40;datetime&amp;#40;2009:2016,2,1&amp;#41;,&amp;#91;&amp;#93;,2&amp;#41;&lt;/code> specifies the start and end date of 4 training phases, with the first column being the datetime of the start and the second column being the end of each training phases.&lt;/p>
&lt;/li>
&lt;li>&lt;p>For example, a 3 by 2 cell array &lt;/p>
&lt;pre>&lt;code>&amp;#123;calyears&amp;#40;7&amp;#41;,datetime&amp;#40;2012,11,11&amp;#41;;...
calyears&amp;#40;7&amp;#41;,datetime&amp;#40;2011,11,11&amp;#41;;...
calyears&amp;#40;7&amp;#41;,datetime&amp;#40;2010,11,11&amp;#41;&amp;#125;;&lt;/code>&lt;/pre>
&lt;p>specifies the end day of the training phases as 2010-Nov-11, 2011-Nov-11 and 2012-Nov-11, all having a length of 7-year-long training period &amp;#40;i.e. &lt;code>calyears&amp;#40;7&amp;#41;&lt;/code>&amp;#41;. If the duration is negative &amp;#40;e.g. &lt;code>-calyears&amp;#40;7&amp;#41;&lt;/code>&amp;#41;, the datetime of the second column become the first day of each training phase.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>calyears&amp;#40;7&amp;#41;&lt;/code>, which specifies the end day of training phase the day before the last day of statistical indices or anomaly index number, with a length of 7 year period. That is, in default it &amp;quot;trains&amp;quot; and gives the best models according to the most recent 7-year data.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;modparam&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>Specify the model parameters for grid search. It should be a cell array; all elements in the cell array will be directly passed into &lt;code>modparam&amp;#40;&amp;#41;&lt;/code> as input arguments.&lt;/p>
&lt;/li>
&lt;li>&lt;p>For example, &amp;#123;&lt;code>&amp;#39;Athr&amp;#39;,&amp;#91;1:2:10&amp;#93;,&amp;#39;Rc&amp;#39;,&amp;#91;20, 30&amp;#93;&lt;/code>&amp;#125;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>&amp;#123;&amp;#125;&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;AdditionalCheck&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>Apply some additional check and tests. This option is for developer.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>false&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Input and output:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>molscore&lt;/code> takes anomaly indices from &lt;code>dir_tsAIN&lt;/code> and earthquake catalog and station information from &lt;code>dir_catalog&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>The output ranked models are saved in &lt;code>dir_molchan&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;ul>
&lt;li>The output directory and data structure is:
&lt;img src="struct_molchan.png" alt="">&lt;/li>
&lt;/ul>
&lt;div class="markdown">&lt;p>&lt;code>molscore_parfor&lt;/code> is the parallel computing version of &lt;code>molscore&lt;/code>, it takes the same input arguments and keyword options as &lt;code>molscore&lt;/code>.&lt;/p>
&lt;/div>
&lt;h3 id="joint-station-3-d-tip-and-molchan-score-calculation-molscore3">Joint-station (3-D) TIP and Molchan Score Calculation (&lt;code>molscore3&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>molscore3&lt;/code> calculates the joint-station TIP, the Molchan score between EQK and TIP, the Hit rate, and the earthquake probability. The calculation is based on optimized model given by &lt;code>molscore&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;pre>&lt;code>dir_catalog &amp;#61; &amp;#39;\MagTIP-2021\spreadsheet&amp;#39;;
dir_tsAIN &amp;#61; &amp;#39;\MagTIP-2021\output_var\tsAIN-J13-TZ2&amp;#39;;
dir_molchan &amp;#61; &amp;#39;\MagTIP-2021\output_var\MolchanScore-J13-TZ2&amp;#39;;
dir_jointstation &amp;#61; &amp;#39;\MagTIP-2021\output_var\JointStation-J13-TZ2&amp;#39;;
molscore3&amp;#40;dir_tsAIN,dir_molchan,dir_catalog,dir_jointstation&amp;#41;&lt;/code>&lt;/pre>
&lt;p>&lt;strong>Keyword Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;ForecastingPhase&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>It can be a N by 2 datetime array with its size identical to the training phases &amp;#40;&lt;code>trnphase&lt;/code>&amp;#41;, specifying the time ranges of N forecasting phases.&lt;/p>
&lt;/li>
&lt;li>&lt;p>It can be &amp;#39;calendarDuration&amp;#39; or &amp;#39;duration&amp;#39;, saying &lt;code>T&lt;/code>. In this case, saying the last day of the training phase is &lt;code>trnphase&amp;#40;i, end&amp;#41;&lt;/code>, the forecasting phases are set to start from &lt;code>trnphase&amp;#40;i, end&amp;#41; &amp;#43; 1&lt;/code>, and end at &lt;code>trnphase&amp;#40;i, end&amp;#41; &amp;#43; T&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;auto&amp;#39;. In this case, forecasting phases are set to be as long as possible. That is, until the last day where tsAIN is available.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is one calendar year: &lt;code>calyears&amp;#40;1&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Also see &lt;code>formatForecastingPhase&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;OverwriteFile&amp;#39; &lt;/p>
&lt;ul>
&lt;li>&lt;p>Whether to overwrite existing output files or not.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>true&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;ModelSelect&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>see &lt;code>bestmodel&amp;#40;&amp;#41;&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;ModelSelectOP&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>see &lt;code>bestmodel&amp;#40;&amp;#41;&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;ChooseBest&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>Define the number of maximum best models for each station to be applied. &lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is 10, which means we pick the models of top 10 fitting degrees each station for calculating predicted TIP&amp;#40;s&amp;#41;.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;CombinationNumber&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>Define the total number of random combinations among the best models of each station for joint-station TIP calculation. &lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is 500, which means for every station a random permutation of ranking numbers &amp;#40;based on the fitting degree&amp;#41; of the best models is performed with each sequence of ranking number having 500 elements, and the ith joint-station model parameter combination is thus from the best models of each station indexed by the ith element of each permutation. &lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Input and output:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>molscore3&lt;/code> takes anomaly indices from &lt;code>dir_tsAIN&lt;/code>, earthquake catalog and station information from &lt;code>dir_catalog&lt;/code>, and ranked model form &lt;code>dir_molchan&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>The output probability is saved in &lt;code>dir_jointstation&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;ul>
&lt;li>The output directory and data structure is:
&lt;img src="struct_jointstation.png" alt="">&lt;/li>
&lt;/ul>
&lt;div class="markdown">&lt;p>&lt;code>molscore3_parfor&lt;/code> is the parallel computing version of &lt;code>molscore3&lt;/code>, it takes the same input arguments and keyword options as &lt;code>molscore3&lt;/code>.&lt;/p>
&lt;/div>
&lt;h2 id="format">Format&lt;/h2>
&lt;div class="markdown">&lt;p>&lt;code>fmt&lt;/code> is a class that &lt;/p>
&lt;ol>
&lt;li>&lt;p>stores all constant names&lt;/p>
&lt;/li>
&lt;li>&lt;p>stores all constant variables&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>that enalbes you to modify or extend some contants without breaking other functionalities.&lt;/p>
&lt;p>&lt;code>fmt&lt;/code> also serves as &amp;quot;dictionaries&amp;quot; of names to corresponding variables.&lt;/p>
&lt;p>&lt;strong>Functions&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>colindex2data&amp;#40;what_type&amp;#41;&lt;/code>: returns column indices to time and data part of the loaded matrix. Example: &lt;code>&amp;#91;colind_time, colind_data&amp;#93; &amp;#61; colindex2data&amp;#40;&amp;#39;GEMS0&amp;#39;&amp;#41;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>filterRange&amp;#40;filter_tag&amp;#41;&lt;/code>: returns two values indicating the lower and upper limit of the filter, in the unit of Hz. Example: &lt;code>fmt.filterRange&amp;#40;ULF_A&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>expecteddatapoint&amp;#40;what_type&amp;#41;&lt;/code>: returns the expected number of data point of a specific file type. Example: &lt;code>totalpts &amp;#61; expecteddatapoint&amp;#40;&amp;#39;GEMS0&amp;#39;&amp;#41;&lt;/code>; and you can derive sampling frequency &lt;code>fs&lt;/code> by &lt;code>fs &amp;#61; totalpts/86400&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>fmtfieldname &amp;#61; datatype_fieldname&amp;#40;what_type&amp;#41;&lt;/code>: returns the field name for &lt;code>fmt&lt;/code> that you can &lt;code>fmt.&amp;#40;fmtfieldname&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="standard-input-data-name">Standard input-data name&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;fname&amp;#93; &amp;#61; standarddataname&amp;#40;stnm, dtstr, type_j&amp;#41;&lt;/code> returns the file name of the standard data format. For example, &lt;code>standarddataname&amp;#40;&amp;#39;HUAL&amp;#39;, &amp;#39;20120202&amp;#39;, &amp;#39;GEMS0&amp;#39;&amp;#41;&lt;/code> returns &lt;code>stn&amp;#91;HUAL&amp;#93;dt&amp;#91;20120202&amp;#93;type&amp;#91;GEMS0&amp;#93;.mat&lt;/code>.&lt;/p>
&lt;/div>
&lt;h2 id="subfunctions">Subfunctions&lt;/h2>
&lt;p>Subfunctions are those a user normally do not have a chance to use. However, if you are a developer, the information will be very helpful.&lt;/p>
&lt;h3 id="sum-of-anomaly-indices-convain">Sum of Anomaly Indices (&lt;code>convAIN&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>Calculate the total amount of anomaly indices of each day. That is, saying we have two statistical indices &lt;code>S&lt;/code> and &lt;code>K&lt;/code>, and the total amount of anomaly indices is less or equal than 2. It is the &amp;#39;update_tsAIN&amp;#39; of the previous version.&lt;/p>
&lt;p>&lt;strong>Example&lt;/strong>:&lt;/p>
&lt;pre>&lt;code>&amp;#91;sum_tsAIN, sum_validateIndex&amp;#93; &amp;#61; convAIN&amp;#40;tsAIN.Athr, tsAIN.validateIndex&amp;#41;&lt;/code>&lt;/pre>
&lt;p>For each Athr we have one anomaly index &amp;#40;true or false&amp;#41; and validation index &amp;#40;true or false&amp;#41; per day per variable, and the output is the number of &amp;quot;trues&amp;quot; per day. Usually Athr &amp;#61; 1:10, so the output will be a 10 by 1 cell in each there is a N by 1 double; N is the length of the DateTime series.&lt;/p>
&lt;p>&lt;strong>Input arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>tsAIN.Athr&lt;/code> or &lt;code>tsAIN.validateIndex&lt;/code>: A 1-by-10 structure array. See &lt;code>anomalyind&lt;/code> for more information.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>sum_tsAIN&lt;/code> or &lt;code>sum_validateIndex&lt;/code>: A 10-by-1 cell array corresponding to &amp;#36;A_&amp;#123;thr&amp;#125; &amp;#61; 1:10&amp;#36;. In each cell, there is a N-by-1 double array being the sum of anomaly indices or the sum of valid indices of N days. &lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="sum-of-anomaly-days-sumanomalyind">Sum of Anomaly Days (&lt;code>sumanomalyind&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;DateTimeSAT,vlSAT&amp;#93; &amp;#61; sumanomalyind&amp;#40;DateTime_j,sum_tsAIN_k,Nthr_array,Tobs_i&amp;#41;&lt;/code> calculate sum of anomaly day &amp;#40;&lt;code>vlSAT&lt;/code>&amp;#41; and its corresponding datetime series &amp;#40;&lt;code>DateTimeSAT&lt;/code>&amp;#41;. It is simply the moving-window sum of the &lt;code>sum_tsAIN_k&lt;/code> timeseries, where the moving-window length is &lt;code>Tobs_i&lt;/code>; in which, &lt;code>i&lt;/code> stands for &amp;#36;i_&amp;#123;th&amp;#125;&amp;#36; model, &lt;code>j&lt;/code> for &amp;#36;j_&amp;#123;th&amp;#125;&amp;#36; station, and &lt;code>k&lt;/code> for &amp;#36;k_&amp;#123;th&amp;#125;&amp;#36; threshold &amp;#36;A_&amp;#123;thr&amp;#125;&amp;#36;. Of coursely, the number of elements of the output timeseires &amp;#40;&lt;code>DateTimeSAT&lt;/code>&amp;#41; will be &lt;code>Tobs_i - 1&lt;/code> less than the input timeseries &amp;#40;&lt;code>DateTime_j&lt;/code> or &lt;code>DateTime_dti&lt;/code>&amp;#41;; i.e., &lt;code>length&amp;#40;sum_tsAIN_k&amp;#41; - length&amp;#40;vlSAT&amp;#41; &amp;#61; Tobs_i - 1&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Input arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>DateTime_j&lt;/code>: the datetime array for &lt;code>sum_tsAIN&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>sum_tsAIN_k&lt;/code>: the sum of anomaly statistical indices each day.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Nthr_array&lt;/code>: The thresholds for &lt;code>sum_tsAIN_k&lt;/code> calculated according to &lt;code>NthrRatio&lt;/code>. &lt;code>Nthr&lt;/code> is known as the threshold of the total daily amount of anomaly statistical indices.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tobs_i&lt;/code>: the observation window of model i.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>DateTimeSAT&lt;/code>: M-by-1 datetime array for sum of anomaly days&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>vlSAT&lt;/code>: M-by-1 double array for the values of sum of anomaly days &amp;#40;the anomaly days is summed in the moving window of &lt;code>Tobs&lt;/code>&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>See also:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>convAIN&lt;/code> for more details about &lt;code>sum_tsAIN_k&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="the-date-time-at-which-tip-is-true-dt_tip_true">The Date Time at Which TIP is True (&lt;code>dt_TIP_true&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;dt_TIPtrue,TIPtime,TIP&amp;#93; &amp;#61; dt_TIP_true&amp;#40;DateTimeSAT,vlSAT, Tthr,Tlead,Tpred&amp;#41;&lt;/code> return the datetime where TIP is true.&lt;/p>
&lt;p>&lt;strong>Input arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>DateTimeSAT&lt;/code>: M-by-1 datetime array for sum of anomaly days&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>vlSAT&lt;/code>: M-by-1 double array for the values of sum of anomaly days &amp;#40;the anomaly days is summed in the moving window of &lt;code>Tobs&lt;/code>&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tthr&lt;/code>: the threshold related to the number of anomaly days in &lt;code>Tobs&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tlead&lt;/code>: the leading window right before the prediction window&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tpred&lt;/code>: the window of prediction &amp;#40;where TIP is true or false according to the number of anmalies in the corresponding Tobs window&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>dt_TIPtrue&lt;/code>: the datetime where &lt;code>TIP&lt;/code> is true&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TIPtime&lt;/code>: an N-by-1 datetime array paired with the &lt;code>TIP&lt;/code> array&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TIP&lt;/code>: an N-by-1 logical array of Time of Increased Probability&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>The variable &lt;code>dt_TIPtrue&lt;/code> may exceeds the last day of &lt;code>DateTimeSAT&lt;/code>, while &lt;code>TIPtime&lt;/code> is truncated to not exceed &lt;code>DateTimeSAT&amp;#40;end&amp;#41;&lt;/code> in &lt;code>molscore&lt;/code>, because in training phase datetime out of &lt;code>DateTimeSAT&lt;/code> is assumed to be out of the time range of available earthquake catalog.&lt;/p>
&lt;p>&lt;strong>A schematic illustration of the input/output variables:&lt;/strong>&lt;/p>
&lt;pre>&lt;code>sum_validateIndex_all_a_dti &amp;#40;2nd input argument in sumanomalyind&amp;#41;
1100111011000001010010000000001010000000 &amp;#40;for example&amp;#41;
DateTime_dti tttttttttttttttttttttttttttttttttttttttt
Tobs length |-----| &amp;#40;Tobs&amp;#61;7, for example&amp;#41;
Tlead length |-------| &amp;#40;Tlead&amp;#61;9, for example&amp;#41;
vlSAT 5445543222122233222221112122344332 &amp;#40;for example&amp;#41;
DateTimeSAT index 123456789.........................
DateTimeSAT |Tobs |--------------------------------|
TIPtime/TIP |Tobs || Tlead ||--------------------------------------|
↑ |Tobs || Tlead ||Tpred|
Tpred start ↑ last AIN data ↑ Tpred end ↑ &lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="the-date-time-at-which-tip-is-valid-dt_tip_valid">The Date Time at Which TIP is Valid (&lt;code>dt_TIP_valid&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>dt_TIP_valid&lt;/code> gives loosely valid TIP time and strictly invalid TIP time. There are two possibilities for a TIP false: one is that the anomaly index number &amp;#40;AIN&amp;#41; is below the threshold, and the other is that AIN is NaN since anything in comparison with a NaN results in a false. The later we called it an &amp;#39;invalid&amp;#39; TIP time/day.&lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;pre>&lt;code>&amp;#91;TIPtime1,TIP_valid,dates_TIPvalid_st,dates_TIPinvalid_st&amp;#93; &amp;#61; ...
dt_TIP_valid&amp;#40;DateTimeSAT,sum_validateIndex_all_a_dti,Tobs,Tlead,Tpred&amp;#41;&lt;/code>&lt;/pre>
&lt;p>This gives the datetime where there is at least one data in the &lt;code>Tobs&lt;/code> and hence TIP false is a valid false.&lt;/p>
&lt;p>&lt;strong>Input arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>DateTimeSAT&lt;/code>: see &lt;code>sumanomalyind&amp;#40;&amp;#41;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>sum_validateIndex_all_a_dti&lt;/code>: the &lt;code>sum_validateIndex&lt;/code> in &lt;code>convAIN&amp;#40;&amp;#41;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tobs&lt;/code>: the observation time window right before the leading window &amp;#40;&lt;code>Tlead&lt;/code>&amp;#41;. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tlead&lt;/code>: the leading window right before the prediction window&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tpred&lt;/code>: the window of prediction &amp;#40;where TIP is true or false according to the number of anmalies in the corresponding Tobs window&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>TIPtime1&lt;/code>: a 1-d datetime array for &lt;code>TIP_valid&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TIP_valid&lt;/code>: a 1-d logical array indicating whether the TIP is valid or not. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>dates_TIPvalid_st&lt;/code>: Returns the datetimes of where the TIP have a meaningful &lt;code>true&lt;/code>/&lt;code>false&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>dates_TIPinvalid_st&lt;/code>: Returns the datetimes of where the TIP have a meaningless &lt;code>false&lt;/code>. &amp;#40;If TIP is true, then the day should always be valid&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>About the meaningful and meaningless &amp;#39;false&amp;#39;, see the comments in &lt;code>anomalyind&amp;#40;&amp;#41;&lt;/code>&lt;/p>
&lt;p>Recalling that sum of AIN is the sum of anomaly index calculated in the moving time window of length Tobs, and the dates &lt;code>DateTimeSAT&amp;#40;sum_AIN_valid&amp;#41;&lt;/code> denotes the end day of Tobs where at least one of the anomaly index in the Tobs window is meaningful, we have the following example where Tlead &amp;#61; 9, Tobs &amp;#61; 7, and Tpred &amp;#61; 3, for explicitly demonstrates how the TIP&amp;#39;s valid times are calculated:&lt;/p>
&lt;pre>&lt;code>sum_validateIndex_all_a_dti
&amp;#39;1100111011000001010010000000001010000000&amp;#39; &amp;#40;for example&amp;#41;
DateTime_dti tttttttttttttttttttttttttttttttttttttttt|
DateTimeSAT tttttttttttttttttttttttttttttttttt|
sum_AIN_valid 1111111111111111111110001111111110|
dt_AIN_valid ttttttttttttttttttttt ttttttttt |
|Tobs ||&amp;lt;--a---&amp;gt;| |&amp;lt;--b-----&amp;gt;|
TIPtime tttttttttttttttttttttttttttttttttttt
Tpred moving window |c| |c|
| the same length as DateTimeSAT |
TIPvalid_0 123456789........................
\\\\\\\
TIPvalid_1 3456789..........................
&lt;p>Therefore,
dt_TIPvalid = unique(TIPtime([1:3,2:4,3:5,&amp;hellip;.]))&lt;/p>
&lt;p>% t denotes a datetime object
% a = Tlead+1 = idinc2predstart
% b = Tlead+Tpred = idinc2predend
% c = Tred
% dt_AIN_valid is DateTimeSAT(sum_AIN_valid), and sum_AIN_valid is a.k.a Tobs_TF.
% TIPvalid_0 (_1) is a.k.a. TIP_TF_0 (_1)&lt;/code>&lt;/pre>&lt;/p>
&lt;/div>
&lt;h3 id="1-d-eqk-and-tip-eqktip1">1-d EQK and TIP (&lt;code>eqktip1&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;EQK,TIP, TIPtime&amp;#93; &amp;#61; eqktip1&amp;#40;eqMR,eqDateTime, DateTimeSAT,vlSAT, Tthr_iMod,Tlead_iMod,Tpred_iMod, Mc_iMod,Rc_iMod&amp;#41;&lt;/code> provides 1 dimensional logical array of target earthquakes &amp;#40;&lt;code>EQK&lt;/code>&amp;#41; and Time of Increased Probability &amp;#40;&lt;code>TIP&lt;/code>&amp;#41;, corresponding to the 1-d datetime array &lt;code>TIPtime&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Input arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>eqMR&lt;/code>: a N by 2 array of all-combination of model magnitudes and radii of detection, with the first column being magnitude and second column the radius of detection.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>eqDateTime&lt;/code>: a N by 1 cell array. Each cell contains the datetime of target earthquakes satisfying the corresponding row of &lt;code>eqMR&lt;/code>; i.e., being larger than eqMR&amp;#40;i,1&amp;#41; and within eqMR&amp;#40;i,2&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>DateTimeSAT&lt;/code>, &lt;code>vlSAT&lt;/code>: see &lt;code>sumanomalyind&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Tthr&lt;/code>, &lt;code>Tlead&lt;/code>, &lt;code>Tpred&lt;/code>: see &lt;code>dt_TIP_true&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Mc_iMod&lt;/code>: the current model magnitude.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Rc_iMod&lt;/code>: the current model radius of detection.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>EQK&lt;/code>: the M-by-1 logical array for whether there is/are target earthquakes in the day.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TIP&lt;/code>: an M-by-1 logical array of Time of Increased Probability&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TIPtime&lt;/code>: an M-by-1 datetime array paired with the &lt;code>TIP&lt;/code> and &lt;code>EQK&lt;/code> array&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>See also:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>&amp;#91;~,eqMR,eqDateTime&amp;#93; &amp;#61; isearthquakeinrange&amp;#40;...&amp;#41;&lt;/code> in &lt;code>molscore&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>&amp;#91;DateTimeSAT,vlSAT&amp;#93; &amp;#61; sumanomalyind&amp;#40;...&amp;#41;&lt;/code> in &lt;code>molscore&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="joint-station-probability-jointstation">Joint-station Probability (&lt;code>jointstation&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>jointstation&lt;/code> calculates hit rates, alarmed rates, and spatial probability.&lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;p>When it is applied for calculating the hit rates of the training phase:&lt;/p>
&lt;pre>&lt;code>HitRates_trn &amp;#61; jointstation&amp;#40;BestModels,BestModelNames,idPermute,...
sum_tsAINs,sum_validateInds,DateTime_dti,...
CWBcatalog,&amp;#39;CalculateHitRate&amp;#39;,true&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>When it is applied for calculating the forecasting probabilities:&lt;/p>
&lt;pre>&lt;code>&amp;#91;HitRates_frc, AlarmedRates_frc, SpatialProbability, xLon, yLat, ...
validStationTime, ProbTime, TIP3, TIPvalid3, EQKs&amp;#93;...
&amp;#61; jointstation&amp;#40;BestModels,BestModelNames,idPermute,...
sum_tsAINs,sum_validateInds,DateTime_dti,...
CWBcatalog,&amp;#39;CalculateHitRate&amp;#39;,true,...
&amp;#39;CalculateAlarmedRate&amp;#39;,true,&amp;#39;CalculateProbability&amp;#39;,HitRates_trn,...
&amp;#39;StationLocation&amp;#39;,StationLocation&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>&lt;strong>Keyword Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;CalculateHitRate&amp;#39;: Whether to calculate the hit rates. Default is &lt;code>false&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;CalculateAlarmedRate&amp;#39;: Whether to calculate the alarmed rates. Default is &lt;code>false&lt;/code>.&lt;/p>
&lt;ul>
&lt;li>&lt;p>If &amp;#39;CalculateProbability&amp;#39; is true, &amp;#39;CalculateAlarmedRate&amp;#39; will be automatically set to be true since alarmed rates are essential to probability calculation.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;CalculateProbability&amp;#39;: Whether to calculate the spatial probability. Default is &lt;code>false&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;StationLocation&amp;#39;: &lt;/p>
&lt;ul>
&lt;li>&lt;p>A J by 3 table with the column names being &amp;#39;format&amp;#39;, &amp;#39;Lon&amp;#39;, &amp;#39;Lat&amp;#39; and row names &amp;#40;i.e. &lt;code>StationLocation.Properties.RowNames&lt;/code>&amp;#41; the station codes &amp;#40;e.g. &amp;#39;TW&amp;#39;, &amp;#39;CS&amp;#39;,...&amp;#41; of the total J stations.&lt;/p>
&lt;/li>
&lt;li>&lt;p>If &amp;#39;CalculateAlarmedRate&amp;#39; is true, &amp;#39;StationLocation&amp;#39; must be specified; otherwise it is impossible to obtain alarm rates.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>0&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Input arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>BestModels&lt;/code>: A J-by-1 cell array containing the best models of total J stations. In each cell there is a table model parameters.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>BestModelNames&lt;/code>: An J-by-1 cell array containing station names corresponding to &lt;code>BestModels&lt;/code> &amp;#40;also J-by-1 cell array&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>idPermute&lt;/code>: The randomly permuted indices for the best models. See &lt;code>bestmodel&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>sum_tsAINs&lt;/code>: A J-by-1 cell array with each cell corresponding to &lt;code>BestmodelNames&lt;/code>. See &lt;code>loadAIN&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>sum_validateInds&lt;/code>: A J-by-1 cell array with each cell corresponding to &lt;code>BestmodelNames&lt;/code>. See &lt;code>loadAIN&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>DateTime_dti&lt;/code>: A T by 1 datetime array for the time series in &lt;code>sum_tsAINs&lt;/code> and the &lt;code>sum_validateInds&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>CWBcatalog&lt;/code>: A table of earthquake catalog. You may load &lt;code>CWBcatalog&lt;/code> using &lt;code>only1field&amp;#40;&amp;#91;dir_catalog filesep &amp;#39;catalog.mat&amp;#39;&amp;#93;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>HitRates&lt;/code>, &lt;code>AlarmedRates&lt;/code>: M by 1 array, being the hit rates &amp;#40;alarmed rates&amp;#41; of each combination of best models. M is the amounts of total combinations &amp;#40;the &lt;code>totalM&lt;/code> in &lt;code>bestmodel&amp;#40;&amp;#41;&lt;/code>&amp;#41;. They are &lt;code>AlarmedRateForecasting&lt;/code> and &lt;code>HitRatesForecasting&lt;/code> of &lt;code>molscore3&lt;/code>&amp;#39;s output.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>SpatialProbability&lt;/code>: A S by T array of the temporal-spatial forecasting probabilities. It is the output variable &lt;code>Probability&lt;/code> of &lt;code>molscore3&amp;#40;&amp;#41;&lt;/code>. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>xLon&lt;/code> &amp;#40;&lt;code>yLat&lt;/code>&amp;#41;: The longitudes &amp;#40;latitudes&amp;#41; of all spatial points as a S by 1 array. It is the output variable &lt;code>ProbabilityLon&lt;/code> &amp;#40;&lt;code>ProbabilityLat&lt;/code>&amp;#41; of &lt;code>molscore3&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>validStationTime&lt;/code>: A T by J table of the ratio of valid models each day each station. This is for &lt;code>plotProbability&amp;#40;&amp;#41;&lt;/code>, that the ratio will be demonstrated as gradient color in the marker of each station. If the ratio is zero, the marker on map will be hollow. It is the output variable &lt;code>validStationTime&lt;/code> of &lt;code>molscore3&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TIP3&lt;/code>: A S by T TIP array for the first model &amp;#40;out of the total M models&amp;#41;. Since the first element of each cell in &lt;code>idPermute&lt;/code> is always 1, indicating the best model, &lt;code>TIP3&lt;/code> is essentially the TIP array calculated according to the best model parameter. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TIPvalid3&lt;/code>: A spatial-temporal logical array indicating whether a point &amp;#40;s,t&amp;#41; of TIP true or false is meaningful or not. This is also a S by T array. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>ProbTime&lt;/code>: A 1 by T datetime array for &lt;code>TIP3&lt;/code>, &lt;code>TIPvalid3&lt;/code> and &lt;code>SpatialProbability&lt;/code>. This is the &lt;code>ProbabilityTime&lt;/code> of &lt;code>molscore3&lt;/code>&amp;#39;s output. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>EQKs&lt;/code>: The list of target earthquake, with each column&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>time&lt;/code>, &lt;code>Lon&lt;/code>, &lt;code>Lat&lt;/code>, &lt;code>Depth&lt;/code>, &lt;code>Mag&lt;/code>: The time, longitude, latitude, depth and magnitude &amp;#40;&amp;#36;M_L&amp;#36;&amp;#41; of the target earthquake.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>InStation&lt;/code>: Indicates the target earthquake is of which station.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>EqkDist&lt;/code>: The distance between the station &amp;#40;as specified by &lt;code>InStation&lt;/code>&amp;#41; and hypocenter of the target earthquake. Also see &lt;code>simpleStationEQKdist3D&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="anomaly-index-number-of-each-day-loadain">Anomaly Index Number of each day (&lt;code>loadAIN&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;pre>&lt;code>&amp;#91;sum_tsAINs,sum_validateInds,DateTime_dti,AthrList&amp;#93; &amp;#61;
loadAIN&amp;#40;dir_tsAIN,BestModelNames,TimeRange&amp;#41;&lt;/code>&lt;/pre>
&lt;p>load tsAIN, calculate the summation of anomaly index of each day, and truncate the time series to &lt;code>TimeRange&lt;/code>. &lt;/p>
&lt;p>If &lt;code>class&amp;#40;BestModelNames&amp;#41; &amp;#61;&amp;#61; &amp;#39;char&amp;#39;&lt;/code>, for example, &amp;#39;CS&amp;#39;, the output &lt;code>sum_tsAINs&lt;/code> and &lt;code>sum_validateInds&lt;/code> are the 10 by 1 cell array directly, instead of a M by 1 cell array inside the J by 1 cell array where J &amp;#61; 1.&lt;/p>
&lt;p>&lt;strong>Input arguments:&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>dir_tsAIN&lt;/code>: the directory for the saved AIN data. See &lt;code>anomalyind&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>BestModelNames&lt;/code>: an J-by-1 cell array containing station names corresponding to &lt;code>BestModels&lt;/code> &amp;#40;also J-by-1 cell array&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>TimeRange&lt;/code>: a two-element datetime array.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments:&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>sum_tsAINs&lt;/code>: a J-by-1 cell array with each cell corresponding to &lt;code>BestmodelNames&lt;/code>. In each cell there is a 10-by-1 cell corresponding to the list of &amp;#36;A_&amp;#123;thr&amp;#125;&amp;#36; &amp;#40;&lt;code>AthrList &amp;#61; 1:10&lt;/code>&amp;#41;, being the timeseries of the summation of anomaly index of each day.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>sum_validateInds&lt;/code>: a J-by-1 cell array with each cell corresponding to &lt;code>BestmodelNames&lt;/code>. In each cell there is a 10-by-1 cell corresponding to the list of &amp;#36;A_&amp;#123;thr&amp;#125;&amp;#36; &amp;#40;&lt;code>AthrList &amp;#61; 1:10&lt;/code>&amp;#41;, being the summation of the indicators for the valid statistical indices of each day.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="the-best-models-bestmodel">The Best Models (&lt;code>bestmodel&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;BestModels,BestModelNames,idPermute,molList&amp;#93; &amp;#61; bestmodel&amp;#40;molList,BestN,totalM,StationLocation&amp;#41;&lt;/code> filters the best N models out based on fitting degree and perform random permutation of total M combination of them. That is, &lt;code>bestmodel&amp;#40;&amp;#41;&lt;/code> save the best N &amp;#40;at most&amp;#41; models for each station in &lt;code>BestModels&lt;/code>, and gives an array of M elements that are randomly picked from the set of the ranking numbers of the best N &amp;#40;at most&amp;#41; models. &lt;/p>
&lt;p>&lt;strong>Input arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>molList&lt;/code>: The list of paths to the files of ranked models, which are produced by &lt;code>molscore&lt;/code>. Get the &lt;code>molList&lt;/code> using &lt;code>datalist&amp;#40;...&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>BestN&lt;/code>: The number the models of highest molchan score.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>totalM&lt;/code>: The amount of randomly permuted combinations of the best N models. That is, M is the number of joint-station models. Noted that the first model combination is forced to be the combination of the best model of each station.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>StationLocation&lt;/code>: A J by 3 table with the column names being &amp;#39;format&amp;#39;, &amp;#39;Lon&amp;#39;, &amp;#39;Lat&amp;#39; and row names &amp;#40;i.e. &lt;code>StationLocation.Properties.RowNames&lt;/code>&amp;#41; the station codes &amp;#40;e.g. &amp;#39;TW&amp;#39;, &amp;#39;CS&amp;#39;,...&amp;#41; of the total J stations.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>BestModels&lt;/code>: A J-by-1 cell array containing the best models of total J stations. In each cell there is a table model parameters.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>BestModelNames&lt;/code>: An J-by-1 cell array containing station names corresponding to &lt;code>BestModels&lt;/code> &amp;#40;also J-by-1 cell array&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>idPermute&lt;/code>: The randomly permuted indices for the best models. It is a J by 1 cell array, where each cell contains a M by 1 double array being the indices for the Jth &lt;code>BestModels&lt;/code>. Noted that the first element in the M by 1 double array is always &lt;code>1&lt;/code>, which force the first model combination in &lt;code>jointstation&amp;#40;&amp;#41;&lt;/code> to be the combination of the best model of each station &amp;#40;SEE &lt;code>molscore3&amp;#40;&amp;#41;&lt;/code>&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>molList&lt;/code>: The list of paths to the files of ranked models, where the files having all molchan scores to be NaN &amp;#40;hence model parameters cannot be ranked&amp;#41; are excluded.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Keyword Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;NearbyThreshold&amp;#39;: For some reasons &amp;#40;e.g. no target earthquakes at all in the training phase&amp;#41; models cannot be ranked &amp;#40;optimized&amp;#41; for a station &amp;#40;saying &amp;#39;MS&amp;#39;&amp;#41; because all molchan scores are NaN. In this situation, &lt;code>bestmodel&lt;/code> will try to find if there is a near-by station within 15 km &amp;#40;in default&amp;#41;. If there is, for example, a station &amp;#39;PT&amp;#39; nearby within 15km of &amp;#39;MS&amp;#39;, then the ranked model &amp;#39;PT&amp;#39; will be taken instead. That is, in the following process in &lt;code>molscore3&lt;/code>, the best models of &amp;#39;PT&amp;#39; and the AIN based on the geomagnetic data of &amp;#39;MS&amp;#39; are applied for calculating the probabilities around the station of &amp;#39;MS&amp;#39;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;ModelSelect&amp;#39;: You may filter the table of Molchan scores by using this option. For example, with &lt;code>&amp;#39;ModelSelect&amp;#39;, &amp;#123;&amp;#39;Tpred&amp;#39;, 5&amp;#125;&lt;/code>, all rows whose &lt;code>Tpred&lt;/code> is not &lt;code>5&lt;/code> will be discard. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;ModelSelectOP&amp;#39;&lt;/p>
&lt;ul>
&lt;li>&lt;p>The operator function for model selecting if &lt;code>&amp;#39;ModelSelect&amp;#39;&lt;/code> have multiple pairs of input argument. &lt;/p>
&lt;/li>
&lt;li>&lt;p>For example, with &lt;code>&amp;#39;ModelSelect&amp;#39;, &amp;#123;&amp;#39;Tpred&amp;#39;, 5, &amp;#39;Tlead&amp;#39;, 5&amp;#125;, &amp;#39;ModelSelectOP&amp;#39;, @or&lt;/code>, all rows with &lt;code>Tpred&amp;#61;5&lt;/code> or &lt;code>Tlead&amp;#61;5&lt;/code> was kept; others, discarded. &lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>@or&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="station-list-formatting-checkstation">Station List Formatting (&lt;code>checkstation&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;isvalid, msg&amp;#93; &amp;#61; checkstation&amp;#40;dir_catalog&amp;#41;&lt;/code> check if &lt;code>station_location.mat/csv&lt;/code> exist in &lt;code>dir_catalog&lt;/code>, and convert the &lt;code>station_location.csv&lt;/code> to &lt;code>station_location.mat&lt;/code>. After successfully create &lt;code>station_location.mat&lt;/code>, the original &lt;code>station_location.csv&lt;/code> will be moved to the folder &amp;#39;original_csv&amp;#39;.&lt;/p>
&lt;p>If the &lt;code>station_location.csv&lt;/code> does not meet the required format, error will occur. The &lt;code>station_location.csv&lt;/code> has to suffice the following condtions:&lt;/p>
&lt;ul>
&lt;li>&lt;p>The &amp;#39;time&amp;#39; variable should be in the following format: &amp;#39;yyyy/MM/dd&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>HH:mm&amp;#39;.&lt;/p>
&lt;ul>
&lt;li>&lt;p>Other variables except &amp;#39;time&amp;#39; should belong the class of &amp;#39;double&amp;#39;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Basicaly the following headers &amp;#40;column names&amp;#41;,&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&amp;#123;&amp;#39;code&amp;#39;,&amp;#39;format&amp;#39;,&amp;#39;Lon&amp;#39;,&amp;#39;Lat&amp;#39;&amp;#125; have to exist. In which, &lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;code&amp;#39; is the code for the station, whereas &amp;#39;format&amp;#39; is the full name of the station. For example, &amp;#39;MS&amp;#39; &amp;#40;code&amp;#41; corresponds to &amp;#39;馬仕&amp;#39; &amp;#40;format&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Lon&amp;#39; and &amp;#39;Lat&amp;#39; are longitude and latitude of the station respectively.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Aliases for the column names in the &lt;code>station_location.csv&lt;/code> are allowed; see the &lt;strong>Aliases&lt;/strong> section below.&lt;/p>
&lt;p>&lt;strong>Aliases&lt;/strong>: For convenience, aliases of the column name of an variable in &lt;code>station_location.csv&lt;/code> will be automatically converted:&lt;/p>
&lt;ul>
&lt;li>&lt;p>For longitude and latitude, either &amp;#123;&amp;#39;lon&amp;#39;, &amp;#39;longitude&amp;#39;, &amp;#39;Longitude&amp;#39;&amp;#125;,&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&amp;#123;&amp;#39;lat&amp;#39;, &amp;#39;latitude&amp;#39;, &amp;#39;Latitude&amp;#39;&amp;#125; will be converted to &amp;#39;Lon&amp;#39; and &amp;#39;Lat&amp;#39;, respectively.&lt;/p>
&lt;/div>
&lt;h3 id="earthquake-catalog-formatting-checkcatalog">Earthquake Catalog Formatting (&lt;code>checkcatalog&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;isvalid, msg&amp;#93; &amp;#61; checkcatalog&amp;#40;dir_catalog&amp;#41;&lt;/code> check if &lt;code>catalog.mat/csv&lt;/code> exist in &lt;code>dir_catalog&lt;/code>, and convert the &lt;code>catalog.csv&lt;/code> to &lt;code>catalog.mat&lt;/code>. After successfully create &lt;code>catalog.mat&lt;/code>, the original &lt;code>catalog.csv&lt;/code> will be moved to the folder &amp;#39;original_csv&amp;#39;.&lt;/p>
&lt;p>If the &lt;code>catalog.csv&lt;/code> does not meet the required format, error will occur. The &lt;code>catalog.csv&lt;/code> has to suffice the following condtions:&lt;/p>
&lt;ul>
&lt;li>&lt;p>The &amp;#39;time&amp;#39; variable should be in the following format: &amp;#39;yyyy/MM/dd&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>HH:mm&amp;#39;.&lt;/p>
&lt;ul>
&lt;li>&lt;p>Other variables except &amp;#39;time&amp;#39; should belong the class of &amp;#39;double&amp;#39;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Basicaly the following headers &amp;#40;column names&amp;#41;,&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&amp;#123;&amp;#39;time&amp;#39;,&amp;#39;Lon&amp;#39;,&amp;#39;Lat&amp;#39;,&amp;#39;Mag&amp;#39;,&amp;#39;Depth&amp;#39;&amp;#125;, have to exist. &lt;/p>
&lt;p>Aliases for the column names in the &lt;code>catalog.csv&lt;/code> are allowed; see the &lt;strong>Aliases&lt;/strong> section below.&lt;/p>
&lt;p>&lt;strong>Aliases&lt;/strong>: For convenience, aliases of the column name of an variable in &lt;code>catalog.csv&lt;/code> will be automatically converted:&lt;/p>
&lt;ul>
&lt;li>&lt;p>For earthquake magnitudes, the header of either &amp;#123;&amp;#39;Magnitude&amp;#39;, &amp;#39;magnitude&amp;#39;, &amp;#39;ML&amp;#39;&amp;#125; will be automatically converted to &amp;#39;Mag&amp;#39;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>For depths, the header of either &amp;#123;&amp;#39;depth&amp;#39;, &amp;#39;dep&amp;#39;, &amp;#39;Dep&amp;#39;&amp;#125; will be converted to &amp;#39;Depth&amp;#39;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>For longitude and latitude, either &amp;#123;&amp;#39;lon&amp;#39;, &amp;#39;longitude&amp;#39;, &amp;#39;Longitude&amp;#39;&amp;#125;,&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&amp;#123;&amp;#39;lat&amp;#39;, &amp;#39;latitude&amp;#39;, &amp;#39;Latitude&amp;#39;&amp;#125; will be converted to &amp;#39;Lon&amp;#39; and &amp;#39;Lat&amp;#39;, respectively.&lt;/p>
&lt;p>For convenience, in &lt;code>catalog.csv&lt;/code>, if the event time is written in separated two columns &amp;#39;date&amp;#39; and &amp;#39;time&amp;#39;, with format &amp;#39;yyyy-mm-dd&amp;#39; &amp;#40;or &amp;#39;yyyy/mm/dd&amp;#39;&amp;#41; for &amp;#39;date&amp;#39; and &amp;#39;hh:MM:ss&amp;#39; &amp;#40;or &amp;#39;hh:MM&amp;#39;&amp;#41;, they will be merged as a single &amp;#39;time&amp;#39; variable sufficing the format mentioned before.&lt;/p>
&lt;/div>
&lt;h3 id="generate-model-parameters-modparam">Generate Model Parameters (&lt;code>modparam&lt;/code>)&lt;/h3>
&lt;div class="markdown">&lt;p>In MagTIP, model parameters defines TIP and target earthquakes &amp;#40;EQK&amp;#41;. &lt;code>&amp;#91;PredParam,varargout&amp;#93;&amp;#61;modparam&amp;#40;&amp;#41;&lt;/code> generate the whole set of model parameters that are going to be used in the training phase by &lt;code>molscore&lt;/code>. &lt;/p>
&lt;p>&lt;strong>Keyword Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;Rc&amp;#39;: Radius &amp;#40;range&amp;#41; of detection in unit kilometer. Default is &lt;code>&amp;#91;20:10:100&amp;#93;&amp;#41;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;NthrRatio&amp;#39;: &lt;/p>
&lt;ul>
&lt;li>&lt;p>The ratio threshold to be converted to the number of anomalous statistic index every day. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;NthrRatio&amp;#39; should be calculated automatically in &lt;code>molscore&amp;#40;&amp;#41;&lt;/code> according to the maximum possible number of statistic indices among the anomaly index calculated by &lt;code>anomalyind&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>Nthr&lt;/code> is the threshold &amp;#40;integer&amp;#41; for the number of anomalous statistic indices each day.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is &lt;code>&amp;#91;0.01, 0.99&amp;#93;&lt;/code>, which is for the situation where the maximum possible &lt;code>Nthr&lt;/code> is &amp;#36;\leq 2&amp;#36; &amp;#40;i.e., to be &amp;#91;0, 1&amp;#93;&amp;#41;. If you have the maximum possible &lt;code>Nthr&lt;/code> to be &amp;#36;\leq 3&amp;#36; &amp;#40;i.e, &lt;code>Nthr &amp;#61; &amp;#91;0 1 2&amp;#93;&lt;/code>&amp;#41;, &amp;#39;NthrRatio&amp;#39; should be assigned to be &lt;code>&amp;#91;0.01, 0.49, 0.99&amp;#93;&lt;/code> for example. &lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Ptthr&amp;#39;: &lt;code>Ptthr&lt;/code> defines &lt;code>Tobs&lt;/code> through &lt;code>Ptthr &amp;#61; Tthr/Tobs&lt;/code>. Default is &lt;code>&amp;#91;0.1:0.1:0.5&amp;#93;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Tobs&amp;#39;: The length of observation moving window. Default is &lt;code>&amp;#91;5:5:100&amp;#93;&lt;/code>;&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Tpred&amp;#39;: The length of prediction moving window.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Tlead&amp;#39;: The length of leading window, the time gap that is for the period of silent &amp;#40;no-anomaly&amp;#41; right before big earthquakes. &lt;/p>
&lt;ul>
&lt;li>&lt;p>Default is &amp;#91;0:5:100&amp;#93;. &lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Mc&amp;#39;: The magnitude threshold. Default is &lt;code>5&lt;/code>, which means only events of &amp;#36;M_L \geq 5&amp;#36; will be considered as target earthquakes.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Test&amp;#39;:&lt;/p>
&lt;ul>
&lt;li>&lt;p>If true or 1, then the PredParam is reduced to 1000 randomly picked models from the default combination.&lt;/p>
&lt;/li>
&lt;li>&lt;p>If it is a positive integer N other than 1, the predParam is reduced to N randomly picked models.&lt;/p>
&lt;/li>
&lt;li>&lt;p>Default is 0.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Seed&amp;#39;: the seed for the random selection while &amp;#39;Test&amp;#39; is enable. &lt;/p>
&lt;ul>
&lt;li>&lt;p>Seed must be a nonnegative integer seed less than 2^32.&lt;/p>
&lt;/li>
&lt;li>&lt;p>If seed is less than zero, the random selection has its result different everytime.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>PredParam&lt;/code>: The GEMSTIP/MagTIP models of total 8 free parameters: &lt;code>G &amp;#61; &amp;#91;Mag,Rad,NthrRatio,Athr,Tthr,Tobs,Tpred,Tlead&amp;#93;&lt;/code>. &lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Examples:&lt;/strong> - &lt;code>&amp;#91;PredParam, columnNames&amp;#93; &amp;#61; modparam&amp;#40;&amp;#39;OutputFormat&amp;#39;,&amp;#39;double&amp;#39;&amp;#41;;&lt;/code> - &lt;code>&amp;#91;PredParam_table&amp;#93; &amp;#61; modparam&amp;#40;&amp;#39;OutputFormat&amp;#39;,&amp;#39;table&amp;#39;&amp;#41;;&lt;/code>&lt;/p>
&lt;/div>
&lt;h2 id="tools">Tools&lt;/h2>
&lt;p>All Tools are not necessary for the MagTIP algorithm; they are invented, for example, to demonstrate the results in figure or for generating/selecting directories in a convenient way.&lt;/p>
&lt;h3 id="plotting">Plotting&lt;/h3>
&lt;h4 id="overview-of-all-geomagnetic-data-plot_dataoverview">Overview of All Geomagnetic Data (&lt;code>plot_dataoverview&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>plot_dataoverview&amp;#40;dir_stat, dir_catalog&amp;#41;&lt;/code> plot an overview of all data. &lt;strong>Keyword Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;SaveFigureTo&amp;#39;: the output path&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;BackgroundColor&amp;#39;: Background color; default is white &amp;#40;&lt;code>&amp;#91;1,1,1&amp;#93;&lt;/code>&amp;#41;&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;DatetimeTicks&amp;#39;: The format of datetime ticks on the x-axis. &lt;/p>
&lt;ul>
&lt;li>&lt;p>Default is &lt;code>&amp;#123;&amp;#39;yyyy-mm&amp;#39;,6,&amp;#39;Months&amp;#39;&amp;#125;&lt;/code>, which means tick labels are in the format of &lt;code>yyyy-mm&lt;/code> and interspaced every 6 months.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h4 id="probability-forecast-map-plotprobability">Probability Forecast Map (&lt;code>plotProbability&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>plotProbability&amp;#40;dir_jointstation,dir_catalog,dir_out&amp;#41;&lt;/code> plots two-dimensional probability forecasting maps; the results are saved as png files in &lt;code>dir_output&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Keyword Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;LongitudeLimit&amp;#39;: The longitude limits of the displayed map. Default is &lt;code>&amp;#91;119 122.5&amp;#93;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;LatitudeLimit&amp;#39;: The latitude limits of the displayed map. Default is &lt;code>&amp;#91;21.5 26&amp;#93;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;TimeRange&amp;#39;: Manually assign time ranges or specific dates that must lay in the forecasting phase to plotting probability forecast. If not set, the probability forecast of every available dates will be plotted. The assigned datetime array must be either: &lt;/p>
&lt;ol>
&lt;li>&lt;p>An N by 2 datetime array specifying N ranges at one time.&lt;/p>
&lt;/li>
&lt;li>&lt;p>An N by 1 datetime array specifying N days to be plot.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>&lt;p>&amp;#39;PlotEpicenter&amp;#39;: Whether to plot the epicenter&amp;#40;s&amp;#41; of the target earthquakes on the map.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Rigorous&amp;#39;: Whether to drop &amp;#40;ignore&amp;#41; the probability forecasts that are not in the range of the forecasting phases. Default is true. Generally the leading time window &amp;#40;&lt;code>Tlead&lt;/code>&amp;#41; is different among models, and the probability can be calculated as far as the &lt;code>Tlead&lt;/code> of at least one model covered. However, for the dates out of the forecasting phase, only part of the models are applied thus the probability forecast is weaker.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;TargetPattern&amp;#39;: the pattern for filtering the files in &lt;code>dir_jointstation&lt;/code>. Default is to look up all files that fits the pattern &amp;quot;&amp;#91;JointStation&amp;#93;&lt;em>.mat&amp;quot;. For example, you can manually specify it as &amp;quot;&lt;/em>&amp;#91;ULF&lt;em>A&amp;#93;&amp;quot; to give plots of that based on ULF&lt;/em>A only. The pattern should always begin with &amp;quot;&lt;em>&amp;quot; and the last cahracter can never be &amp;quot;&lt;/em>&amp;quot;. For multiple filtering at once &amp;#40;e.g., &lt;code>&amp;#39;*&amp;#91;ULF_B&amp;#93;*&amp;#91;Tpred-1&amp;#93;&amp;#39;&lt;/code>&amp;#41;, join the pattern with &amp;quot;*&amp;quot; and the order is important.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h4 id="fitting-degree-and-molchan-diagram-plotfittingdegree">Fitting Degree and Molchan Diagram (&lt;code>plotFittingDegree&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>plotFittingDegree&amp;#40;dir_jointstation,dir_catalog,dir_png&amp;#41;&lt;/code> gives fitting degree analysis and molchan diagrams for each training-forecasting phase pair according to the results from &lt;code>molscore3&lt;/code>.&lt;/p>
&lt;/div>
&lt;h4 id="visualization-of-1-d-eqk-and-tip-ploteqktip1">Visualization of 1-d EQK and TIP (&lt;code>plotEQKTIP1&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>plotEQKTIP1&amp;#40;dir_tsAIN,dir_molchan,dir_catalog,dir_output&amp;#41;&lt;/code> plot one-dimensional TIP time series for each station with target earthquakes &amp;#40;EQK&amp;#41; scattered over the diagram; the results are saved as png files in &lt;code>dir_output&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Keyword Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;ShowTrainingPhase&amp;#39;: Whether to show the EQK and TIP on the plot. Default is false. &lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;scatter&amp;#39;: Set it &lt;code>true&lt;/code> to plot an additional layer of &lt;code>TIP&amp;#61;&amp;#61;1&lt;/code> as scattered circles. This makes visually inspecting whether target earthquakes lay in the area of &lt;code>TIP&amp;#61;&amp;#61;1&lt;/code> much easier. Default is &lt;code>false&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;Rank&amp;#39;: Choose the model by fitting degree ranking for defining EQK and TIP. Default is &lt;code>1&lt;/code> &amp;#40;plot the EQK and TIP that are defined by the rank 1 model&amp;#41;.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;OnlyStations&amp;#39;: Specify only a subset of station to be displayed on the plot; for example, for &lt;code>&amp;#39;OnlyStations&amp;#39;,&amp;#123;&amp;#39;MS&amp;#39;,&amp;#39;TW&amp;#39;&amp;#125;&lt;/code> only the results of these two stations will be displayed. In default, results of all stations will be displayed.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;datetimeTickArguments&amp;#39;: Manually define the datetime format of the X tick labels. For example, for &lt;code>&amp;#39;datetimeTickArguments&amp;#39;, &amp;#123;&amp;quot;yy&amp;#39; mmm.&amp;quot;, 1,&amp;#39;months&amp;#39;&amp;#125;&lt;/code> the datetime 2012-Nov-12 will be printed as &amp;quot;12&amp;#39; Nov.&amp;quot;. For more information, see &lt;code>datetime_ticks&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;TargetPattern&amp;#39;: See the documentation in &lt;code>plotProbability&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="others">Others&lt;/h3>
&lt;h4 id="reconstruct-molchaninformationmat-constructmolinfo">Reconstruct &lt;code>[Molchan]Information.mat&lt;/code> (&lt;code>constructMolInfo&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>constructMolInfo&amp;#40;dir_molchan,InfoId&amp;#41;&lt;/code> construct the &amp;#39;&amp;#91;MolchanScore&amp;#93;Information.mat&amp;#39; according to existing &amp;#91;Molchanscore&amp;#93;___.mat files if possible. Use this function only if instructed by error message.&lt;/p>
&lt;/div>
&lt;h4 id="calculating-fitting-degrees">Calculating Fitting Degrees&lt;/h4>
&lt;h5 id="calcfittingdegree">&lt;code>calcFittingDegree&lt;/code>&lt;/h5>
&lt;div class="markdown">&lt;p>&lt;code>calcFittingDegree&amp;#40;jpathlist&amp;#41;&lt;/code> according to the given files &amp;#40;&lt;code>jpathlist&lt;/code>&amp;#41; provides the overall alarmed rate, missing rate that allows the calculation of the overall fitting degree. Make sure to provide correct input list of the &lt;code>&amp;#91;JointStation&amp;#93;&lt;/code> variable , for example, those have the same ID and are not overlapped in forecasting time interval for each group; otherwise the calculated fitting degree can be unreasonable.&lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;pre>&lt;code class="language-matlab">dir_png &amp;#61; &amp;#39;D:\GoogleDrive\0MyResearch\CWB_project\CWB2021\Figures&amp;#39;;
jpathlist &amp;#61; datalist&amp;#40;&amp;#39;&amp;#91;JointStation&amp;#93;ID&amp;#91;ou7ud&amp;#93;prp&amp;#91;ULF_B&amp;#93;*.mat&amp;#39;, dir_jointstation&amp;#41;.fullpath;
&amp;#91;AlarmedRate, MissingRate, xticklabel, EQKs, TIP3s, TIPv3s,TIPTimes,LatLons&amp;#93; &amp;#61; calcFittingDegree&amp;#40;jpathlist&amp;#41;;
FittingDegrees &amp;#61; 1 - AlarmedRate - MissingRate;
plotEQKTIP3&amp;#40;dir_png,prp_i, xlabels, EQKs, TIP3s, TIPv3s,TIPTimes, LatLons&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>&lt;strong>Input Arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>jpathlist&lt;/code>: a cell array of the full paths of &lt;code>&amp;#91;JointStation&amp;#93;&lt;/code> files that are produced by &lt;code>molscore3&lt;/code>. You can simpliy obtain the path list by &lt;code>jpathlist &amp;#61; datalist&amp;#40;&amp;#39;&amp;#91;JointStation&amp;#93;ID&amp;#91;ou7ud&amp;#93;*prp&amp;#91;ULF_A&amp;#93;*slc&amp;#91;Tpred-10&amp;#93;*.mat&amp;#39;,dir_jointstation&amp;#41;.fullpath;&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Keyword Arguments&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>&lt;p>&amp;#39;GroupTag&amp;#39;: The tag for grouping the files in &lt;code>jpathlist&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>&lt;p>&amp;#39;GroupNames&amp;#39;: Results are calculated separately according to the assigned group names; alarmed rate, missing rate and so on are only calculated if the file name contains the assigned group names. For example, for &lt;code>...,&amp;#39;GroupNames&amp;#39;,&amp;#123;&amp;#39;Tpred-1&amp;#39;, &amp;#39;Tpred-5&amp;#39;&amp;#125;,&amp;#39;GroupTag&amp;#39;, &amp;#39;slc&amp;#39;,...&lt;/code>, only the files with their names containing tag &amp;#39;slc&amp;#91;Tpred-1&amp;#93;&amp;#39; and &amp;#39;slc&amp;#91;Tpred-5&amp;#93;&amp;#39; are selected, and the results of those being &amp;#39;Tpred-1&amp;#39; and &amp;#39;Tpred-5&amp;#39; are separately calculated. That is, the output &lt;code>xlabel&lt;/code> is &lt;code>&amp;#123;&amp;#39;Tpred-1&amp;#39;, &amp;#39;Tpred-5&amp;#39;&amp;#125;&lt;/code> and other output arguments &amp;#40;e.g. &lt;code>AlarmedRate&lt;/code>&amp;#41; are all cell array of the same dimension as &lt;code>xlabel&lt;/code> containing the results of the groups that are calculated separately. &lt;/p>
&lt;/li>
&lt;li>&lt;p>Noted that You cannot assign &amp;#39;GroupName&amp;#39; without assigning &amp;#39;GroupTag&amp;#39;, but assigning &amp;#39;GroupTag&amp;#39; without assigning &amp;#39;GroupName&amp;#39; is OK, in this case the group names will automatically generated and sorted. &lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h4 id="retrieve-model-parameter-get_modelparam">Retrieve Model Parameter (&lt;code>get_modelparam&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>Use &lt;code>&amp;#91;var1, var2, ...&amp;#93; &amp;#61; get_modelparam&amp;#40;BestModels, &amp;#39;name1&amp;#39;, &amp;#39;name2&amp;#39;,...&amp;#41;&lt;/code> to get specific model parameters uniquely. &lt;code>BestModels&lt;/code> is the output of &lt;code>bestmodel&amp;#40;&amp;#41;&lt;/code>.&lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>Tpreds, Tleads &amp;#61; get_modelparam&amp;#40;BestModels, &amp;#39;Tpred&amp;#39;, &amp;#39;Tlead&amp;#39;&amp;#41;&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h4 id="confidence-boundary-on-the-molchan-diagram-molchan_cb">Confidence Boundary on the Molchan Diagram (&lt;code>Molchan_CB&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>&amp;#91;molt_cb,moln_cb&amp;#93; &amp;#61; Molchan_CB&amp;#40;N,alpha&amp;#41;&lt;/code> gives the confidence boundary in molchan diagram, where &lt;code>&amp;#91;molt_cb,moln_cb&amp;#93;&lt;/code> are the points defining the boundary on the alarmed-rate-against-missing-rate phase plane. &lt;/p>
&lt;p>&lt;strong>Input Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>N&lt;/code>: total number of target events/earthquakes&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>alpha&lt;/code>: &lt;code>1-alpha&lt;/code> is the confidence level. For example, &lt;code>alpha&amp;#61;0.05&lt;/code> means &lt;code>95&amp;#37;&lt;/code> confidence level.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Output Arguments:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>&lt;code>molt_cb&lt;/code>: values corresponding to the alarmed rate&lt;/p>
&lt;/li>
&lt;li>&lt;p>&lt;code>moln_cb&lt;/code>: values corresponding to the missing rate&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Hint:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>Calculate the &amp;#36;D&amp;#36; &amp;#40;fitting degree&amp;#41; values by &lt;code>Dcb &amp;#61; 1 - molt_cb - moln_cb&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h4 id="generate-an-organized-directory-structure-mkdir_default">Generate an Organized directory Structure (&lt;code>mkdir_default&lt;/code>)&lt;/h4>
&lt;p>In fact, all input/output directories can be arbitrarily assigned; we also provide a tool &lt;code>mkdir_default&lt;/code> to automatically generate an organized directory structure.&lt;/p>
&lt;div class="markdown">&lt;p>&lt;code>mkdir_default&lt;/code> creates/makes folders by default and return their directories with default variable names. The default structure is:&lt;/p>
&lt;pre>&lt;code> variable default folder name
╔═ dir_main ═╤═══════════════════════════════════════╗
║ ├─dir_stat &amp;#61; &amp;#39;StatisticIndex&amp;#39; ║
║ ├─dir_tsAIN &amp;#61; &amp;#39;tsAIN&amp;#39; ║
║ ├─dir_molchan &amp;#61; &amp;#39;MolchanScore&amp;#39; ║
║ └─dir_jointstation &amp;#61; &amp;#39;JointStation&amp;#39; ║
╚════════════════════════════════════════════════════╝&lt;/code>&lt;/pre>
&lt;p>&lt;strong>Example:&lt;/strong> &lt;code>&amp;#91;dir_stat, dir_tsAIN, dir_molchan, dir_jointstation&amp;#93; &amp;#61; mkdir_default&amp;#40;fullfile&amp;#40;pwd,&amp;#39;output_var&amp;#39;&amp;#41;&amp;#41;&lt;/code>&lt;/p>
&lt;/div>
&lt;h4 id="inputoutput-directory-selection-dirselectassign">Input/Output Directory Selection (&lt;code>dirselectassign&lt;/code>)&lt;/h4>
&lt;div class="markdown">&lt;p>&lt;code>dirselectassign&amp;#40;var_names...&amp;#41;&lt;/code> prompts user to select directories in a dialog box, and assigned the selected path to workspace with default variable name. If a variable with the same name as the default name has already in the workspace, its assignment will be ignored &amp;#40;i.e. its dialog box won&amp;#39;t pop out&amp;#41;. This is a tool for convenience. You can always assign directories explicitly to variable with any name you like.&lt;/p>
&lt;p>&lt;strong>Example:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;p>Four windows will pop out one by one allowing you to assign directories to variables &lt;code>dir_stat&lt;/code>, &lt;code>dir_tsAIN&lt;/code>, &lt;code>dir_molchan&lt;/code>, &lt;code>dir_jointstation&lt;/code>: &lt;/p>
&lt;pre>&lt;code class="language-matlab">dirselectassign&amp;#40;&amp;#39;dir_stat&amp;#39;,&amp;#39;dir_tsAIN&amp;#39;,&amp;#39;dir_molchan&amp;#39;,&amp;#39;dir_jointstation&amp;#39;&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>&amp;#40;Read the printed message in the Command Window&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>&lt;p>Total 7 windows will pop out one by one allowing you to assign directories to the variables with default names &lt;code>dir_stat&lt;/code>, &lt;code>dir_tsAIN&lt;/code> , &lt;code>dir_molchan&lt;/code>, &lt;code>dir_jointstation&lt;/code>, &lt;code>dir_data&lt;/code>, &lt;code>dir_catalog&lt;/code>, &lt;code>dir_toolbox&lt;/code>:&lt;/p>
&lt;pre>&lt;code class="language-matlab">dirselectassign&amp;#40;&amp;#41;;&lt;/code>&lt;/pre>
&lt;p>&amp;#40;Read the printed message in the Command Window&amp;#41;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div></description></item><item><title>Docs: Setting up MagTIP</title><link>https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_git/</link><pubDate>Sat, 15 Jan 2022 00:00:00 +0000</pubDate><guid>https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_git/</guid><description>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">Notice&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://github.com/okatsn/MagTIP-2022">MagTIP-2022&lt;/a> and its dependent &lt;a href="https://github.com/okatsn/toolbox">toolbox&lt;/a> are hosted on Github; in which, &lt;a href="https://github.com/okatsn/MagTIP-2022">MagTIP-2022&lt;/a> is private.&lt;/li>
&lt;li>To use MagTIP, you need to have a Github account and get authorized in order to access the repository.&lt;/li>
&lt;/ul>
&lt;/div>
&lt;div class="alert alert-info" role="alert">
&lt;h4 class="alert-heading">Hint&lt;/h4>
&lt;ul>
&lt;li>Have &lt;a href="https://git-scm.com/downloads">Git&lt;/a> installed before you can use the command in the following sections.&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h2 id="im-a-user-of-magtip">I&amp;rsquo;m a user of MagTIP&lt;/h2>
&lt;p>Right click on the links to download the batch files below and:&lt;/p>
&lt;ul>
&lt;li>Double click on the file &lt;a href="./clone_MagTIP_and_toolbox.bat">clone_MagTIP_and_toolbox.bat&lt;/a> to clone and set upstream for MagTIP and its dependent toolbox (do this only once).&lt;/li>
&lt;li>Double click on &lt;a href="./force_update.bat">force_update.bat&lt;/a> to make the local up-to-date with the latest MagTIP (⚠️&lt;strong>any changes on the source code will be lost&lt;/strong>).&lt;/li>
&lt;/ul>
&lt;h2 id="im-a-developer-of-magtip">I&amp;rsquo;m a developer of MagTIP&lt;/h2>
&lt;ul>
&lt;li>MagTIP-2022 depends on &lt;a href="https://github.com/okatsn/toolbox">okatsn&amp;rsquo;s toolbox&lt;/a>; therefore, in git bash (or command window), &lt;code>git clone https://github.com/okatsn/toolbox.git&lt;/code> first (the target directory can be arbitrary chosen).&lt;/li>
&lt;li>Go to &lt;a href="https://github.com/okatsn/MagTIP-2022/">https://github.com/okatsn/MagTIP-2022/&lt;/a> and fork it (&lt;a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo">see how to fork&lt;/a>).&lt;/li>
&lt;li>In git bash (or command window) clone your fork to local,
&lt;ul>
&lt;li>for example, &lt;code>git clone https://github.com/YOURNAME/MagTIP-2022/&lt;/code>&lt;/li>
&lt;li>&lt;a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo#cloning-your-forked-repository">more details about how to clone&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>cd MagTIP-2022&lt;/code> and set up for synchronization (&lt;a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo#configuring-git-to-sync-your-fork-with-the-original-repository">see here for how to set upstream&lt;/a>: &lt;code>git remote add upstream https://github.com/okatsn/MagTIP-2022.git&lt;/code>&lt;/li>
&lt;li>Create a pull request to request for merging your work with the main.&lt;/li>
&lt;li>For more about how to use git, see &lt;a href="https://CGRG-lab.github.io/doc-archive/docs/learning-resources/git/">here&lt;/a>.&lt;/li>
&lt;/ul></description></item></channel></rss>