<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.98.0"><link rel=alternate type=application/rss+xml href=https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_tutorial/index.xml><meta name=robots content="index, follow"><link rel="shortcut icon" href=/doc-archive/favicons/favicon.ico><link rel=apple-touch-icon href=/doc-archive/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/doc-archive/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/doc-archive/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/doc-archive/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/doc-archive/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/doc-archive/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/doc-archive/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/doc-archive/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/doc-archive/favicons/android-192x192.png sizes=192x192><title>Introduction and Tutorial | doc-archive</title><meta name=description content><meta property="og:title" content="Introduction and Tutorial"><meta property="og:description" content="Docsy does docs"><meta property="og:type" content="website"><meta property="og:url" content="https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_tutorial/"><meta itemprop=name content="Introduction and Tutorial"><meta itemprop=description content="Docsy does docs"><meta name=twitter:card content="summary"><meta name=twitter:title content="Introduction and Tutorial"><meta name=twitter:description content="Docsy does docs"><link rel=preload href=/doc-archive/scss/main.min.bd5285b713d3061549a6bfd34e5f4ec6775ede36672a3088260f0d420050647f.css as=style><link href=/doc-archive/scss/main.min.bd5285b713d3061549a6bfd34e5f4ec6775ede36672a3088260f0d420050647f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/doc-archive/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">doc-archive</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/doc-archive/docs/><i class="fas fa-book"></i><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/doc-archive/log/><i class="fas fa-calendar-alt"></i><span>Project</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/doc-archive/docs/magtip/><i class="fas fa-book"></i><span class=active>MagTIP</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://cgrg.synology.me/CGRG/ target=_blank><i class="fas fa-external-link-alt"></i><span>CGRG website</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/CGRG-lab/doc-archive/ target=_blank><i class="fab fa-github"></i><span>GitHub</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/doc-archive/zh/>正體中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><script>$(function(){$("#td-section-nav a").removeClass("active"),$("#td-section-nav #m-doc-archivedocsmagtipdoc_tutorial").addClass("active"),$("#td-section-nav #m-doc-archivedocsmagtipdoc_tutorial-li span").addClass("td-sidebar-nav-active-item"),$("#td-section-nav #m-doc-archivedocsmagtipdoc_tutorial").parents("li").addClass("active-path"),$("#td-section-nav li.active-path").addClass("show"),$("#td-section-nav li.active-path").children("input").prop("checked",!0),$("#td-section-nav #m-doc-archivedocsmagtipdoc_tutorial-li").siblings("li").addClass("show"),$("#td-section-nav #m-doc-archivedocsmagtipdoc_tutorial-li").children("ul").children("li").addClass("show"),$("#td-sidebar-menu").toggleClass("d-none")})</script><div id=td-sidebar-menu class="td-sidebar__inner d-none"><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/doc-archive/zh/docs/best-practices/git/>正體中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-doc-archivedocs-li><a href=/doc-archive/docs/ title=doc-archive class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-doc-archivedocs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-doc-archivedocsbest-practices-li><input type=checkbox id=m-doc-archivedocsbest-practices-check>
<label for=m-doc-archivedocsbest-practices-check><a href=/doc-archive/docs/best-practices/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocsbest-practices><span>Best practices</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocsbest-practicesgit-li><input type=checkbox id=m-doc-archivedocsbest-practicesgit-check>
<label for=m-doc-archivedocsbest-practicesgit-check><a href=/doc-archive/docs/best-practices/git/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-doc-archivedocsbest-practicesgit><span>Git</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocsbest-practicesmatlab-li><input type=checkbox id=m-doc-archivedocsbest-practicesmatlab-check>
<label for=m-doc-archivedocsbest-practicesmatlab-check><a href=/doc-archive/docs/best-practices/matlab/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-doc-archivedocsbest-practicesmatlab><span>Matlab</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-doc-archivedocslearning-resources-li><input type=checkbox id=m-doc-archivedocslearning-resources-check>
<label for=m-doc-archivedocslearning-resources-check><a href=/doc-archive/docs/learning-resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocslearning-resources><span>Learning resources</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocslearning-resourcesscientific_computing-li><input type=checkbox id=m-doc-archivedocslearning-resourcesscientific_computing-check>
<label for=m-doc-archivedocslearning-resourcesscientific_computing-check><a href=/doc-archive/docs/learning-resources/scientific_computing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-doc-archivedocslearning-resourcesscientific_computing><span>Scientific computing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocslearning-resourcesinverse_problem-li><input type=checkbox id=m-doc-archivedocslearning-resourcesinverse_problem-check>
<label for=m-doc-archivedocslearning-resourcesinverse_problem-check><a href=/doc-archive/docs/learning-resources/inverse_problem/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-doc-archivedocslearning-resourcesinverse_problem><span>Inverse problem</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocslearning-resourcesgit-li><input type=checkbox id=m-doc-archivedocslearning-resourcesgit-check>
<label for=m-doc-archivedocslearning-resourcesgit-check><a href=/doc-archive/docs/learning-resources/git/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocslearning-resourcesgit><span>Git</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-doc-archivedocstools-li><input type=checkbox id=m-doc-archivedocstools-check>
<label for=m-doc-archivedocstools-check><a href=/doc-archive/docs/tools/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocstools><span>Tools</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocstoolsearth_science-li><input type=checkbox id=m-doc-archivedocstoolsearth_science-check>
<label for=m-doc-archivedocstoolsearth_science-check><a href=/doc-archive/docs/tools/earth_science/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-doc-archivedocstoolsearth_science><span>Earth science</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-doc-archivedocsmagtip-li><input type=checkbox id=m-doc-archivedocsmagtip-check>
<label for=m-doc-archivedocsmagtip-check><a href=/doc-archive/docs/magtip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocsmagtip><span>MagTIP</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocsmagtipdoc_tutorial-li><input type=checkbox id=m-doc-archivedocsmagtipdoc_tutorial-check>
<label for=m-doc-archivedocsmagtipdoc_tutorial-check><a href=/doc-archive/docs/magtip/doc_tutorial/ title="Introduction and Tutorial" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocsmagtipdoc_tutorial><span>Introduction & Tutorial</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocsmagtipdoc_library-li><input type=checkbox id=m-doc-archivedocsmagtipdoc_library-check>
<label for=m-doc-archivedocsmagtipdoc_library-check><a href=/doc-archive/docs/magtip/doc_library/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocsmagtipdoc_library><span>Library</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-doc-archivedocsmagtipdoc_git-li><input type=checkbox id=m-doc-archivedocsmagtipdoc_git-check>
<label for=m-doc-archivedocsmagtipdoc_git-check><a href=/doc-archive/docs/magtip/doc_git/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-doc-archivedocsmagtipdoc_git><span>Setting up MagTIP</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/CGRG-lab/doc-archive/edit/master/content/en/docs/magtip/doc_tutorial/_index.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/CGRG-lab/doc-archive/new/master/content/en/docs/magtip/doc_tutorial/_index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/CGRG-lab/doc-archive/issues/new?title=Introduction%20and%20Tutorial" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#environment>Environment</a></li><li><a href=#getting-started>Getting Started</a><ul><li><a href=#the-sample-script-for-everything>The Sample Script for Everything</a></li><li><a href=#inputoutput-directories>Input/Output Directories</a></li></ul></li><li><a href=#prepare-your-data>Prepare Your Data</a><ul><li><a href=#format-of-station-list-and-earthquake-catalog>Format of Station list and Earthquake Catalog</a></li><li><a href=#standard-data-format>Standard data format</a></li></ul></li><li><a href=#the-main-process>The Main Process</a></li><li><a href=#visualization-of-the-results>Visualization of the Results</a><ul><li><a href=#probability-forecast>Probability Forecast</a></li><li><a href=#the-matching-diagram>The Matching Diagram</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://CGRG-lab.github.io/doc-archive/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://CGRG-lab.github.io/doc-archive/docs/magtip/>MagTIP</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_tutorial/>Introduction & Tutorial</a></li></ol></nav><div class=td-content><h1>Introduction and Tutorial</h1><header class=article-meta></header><h2 id=introduction>Introduction</h2><p>MagTIP calculates the TIP (Time of Increased Probability) of earthquakes basing on the geomagnetic records of Central Weather Bureau of Taiwan.
The algorithm allows for the optimization of the model parameters, and gives the overall TIP (named joint-station TIP).
The probability of capturing a target event in space and time can be derived based on the joint-station TIP, by considering the results from a large set of randomly permuted of model parameters simultaneously.</p><p>In the traditional TIP forecasting, the type and the number of input data have to be uniquely formatted otherwise re-training according to the new format is required.
As a result, either the conversion for fitting new data to old format (where some information must lose), or an extra waiting period (e.g. 7 years) for re-training models with new data, is required.
The time scale of the evolution of the underground dynamical system is generally thought to be large, hence data collected from old stations are precious. For being able to fully utilizing both the data from the most modern instruments and older sensors, the project of this year aims for the multivariate MagTIP forecasting system.</p><p>The newest multivariate MagTIP forecasting system not only supports three-component and one-component geomagnetic signals simultaneously, but also allows additional earthquake-relevant time series to be involved in calculating TIP.</p><h2 id=environment>Environment</h2><p>Type <code>license('inuse')</code> or <code>ver</code> to see all the toolboxes you have.</p><div class=markdown><p><strong>MATLAB Version</strong>: 9.11.0.1809720 (R2021b) Update 1 <strong>Operating System</strong>: Microsoft Windows 10 企業版 Version 10.0 (Build 19044) <strong>Java Version</strong>: Java 1.8.0_202-b08 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode</p><p><strong>Toolbox in-use</strong>:</p><ul><li><p>MATLAB Version 9.11 (R2021b)</p></li><li><p>Mapping Toolbox Version 5.2 (R2021b)</p></li><li><p>Parallel Computing Toolbox Version 7.5 (R2021b)</p></li><li><p>Signal Processing Toolbox Version 8.7 (R2021b)</p></li><li><p>Statistics and Machine Learning Toolbox Version 12.2 (R2021b)</p></li></ul></div><h2 id=getting-started>Getting Started</h2><p>The main functions of MagTIP take directories that contains necessary files as input arguments, and all output variables are saved in another directory as &ldquo;.mat&rdquo; files.
In this document, the input/output variable that contains the information of the path to a directory (i.e., a folder) is prefixed by <code>dir_</code>; for example, <code>dir_data</code> is the directory for the formatted geomagnetic data, and <code>dir_stat</code> is the directory for statistic indices.
The <code>dir_</code>-prefixed variables are each a sequence of characters being something like <code>'D:\MagTIP-2022\output_var\StatisticIndex'</code>.</p><h3 id=the-sample-script-for-everything>The Sample Script for Everything</h3><p>There is a script <strong>&ldquo;demo/demo_script.m&rdquo;</strong> contains the sample codes of the whole process; you can easily make everything set and go through the entire MagTIP procedures following the steps below:</p><ul><li>switch current directory to the folder named &ldquo;MagTIP-2022&rdquo;</li><li>run section(s) in the script</li></ul><p>In the beginning (the first three sections), you will see several pop-out windows for selecting the directory of geomagnetic data (<code>dir_data</code>) and loading the toolbox (<code>dir_toolbox</code>).
Select the right folders as instructed, and they will be automatically added to path and be ready to use.</p><h3 id=inputoutput-directories>Input/Output Directories</h3><p>Assigning directories for input/output data or variables is necessary before running any application.
For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#000>dir_catalog</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;data\spreadsheet&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>% directory of event catalog &amp; station location</span>
</span></span><span style=display:flex><span><span style=color:#000>dir_data</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;data\geomag_1&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>% directory of geomagnetic timeseries</span>
</span></span><span style=display:flex><span><span style=color:#000>dir_stat</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;output_var\StatisticIndex&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>% directory of statistic indices</span>
</span></span><span style=display:flex><span><span style=color:#000>dir_tsAIN</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;output_var\tsAIN&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>% directory for storing anomaly index number (AIN)</span>
</span></span><span style=display:flex><span><span style=color:#000>dir_molchan</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;output_var\Molchan&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>% directory for storing Molchan scores</span>
</span></span><span style=display:flex><span><span style=color:#000>dir_jointstation</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;output_var\JointStation&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>% directory for the time series of EQK, TIP and probability</span>
</span></span></code></pre></div><p>This can be done alternatively using <code>mkdir_default()</code> to create the set of empty folders with each folder name never repeats.
That is, the code chunk above is equivalent to</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#000>dir_catalog</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;data\spreadsheet&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span><span style=color:#000>dir_data</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;data\geomag_1&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>dir_stat</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dir_tsAIN</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dir_molchan</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dir_jointstation</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>mkdir_default</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;output_var&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Here is an overview of this default directory structure:
<img src=dirtree.svg alt></p><p>You can create this directory structure manually by adding new folders using your OS&rsquo;s interface.
You can also assign the <code>dir_</code>-prefixed variables by using <code>dirselectassign(...)</code>, where windows pop out for selecting existing directory.
For more information, see &ldquo;demo_script.m&rdquo; and &ldquo;dirselectassign.m&rdquo;.</p><p><strong>⚠Notice:</strong></p><ol><li><code>dir_spreadsheet</code> must contain <code>catalog.csv</code> and <code>station_location.csv</code>, with the first row (column names) being &lsquo;code&rsquo;, &lsquo;format&rsquo;, &lsquo;Lon&rsquo;, &lsquo;Lat&rsquo; for <code>station_location.csv</code>, and &rsquo;time&rsquo;, &lsquo;Lon&rsquo;, &lsquo;Lat&rsquo;, &lsquo;Depth&rsquo;, and &lsquo;Mag&rsquo; for <code>catalog.csv</code>.</li><li>The order of column names can be arbitrarily arranged, but the strings have to be exactly the same as above.</li><li>Geomagnetic time series in <code>dir_data</code> should be converted to the standard format. For more information, see <code>conv_geomagdata</code>.</li></ol><h2 id=prepare-your-data>Prepare Your Data</h2><h3 id=format-of-station-list-and-earthquake-catalog>Format of Station list and Earthquake Catalog</h3><p>The <code>station_location.csv</code> specifies the location of every station;
here is an example for <code>station_location.csv</code>:</p><table><thead><tr><th>code</th><th>format</th><th>Lon</th><th>Lat</th></tr></thead><tbody><tr><td>MS</td><td>馬仕</td><td>120.633</td><td>22.61089</td></tr><tr><td>TW</td><td>灣丘</td><td>120.5286</td><td>23.18502</td></tr><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr><tr><td>XC</td><td>新城</td><td>121.6095</td><td>24.0383</td></tr><tr><td>SM</td><td>日月潭</td><td>120.9076</td><td>23.881</td></tr></tbody></table><p>The <code>catalog.csv</code> is the catalog covering at least the entire range of all training phases;
here is an example for <code>catalog.csv</code>:</p><table><thead><tr><th>time</th><th>Lon</th><th>Lat</th><th>Depth</th><th>Mag</th></tr></thead><tbody><tr><td>2020/8/10 06:41</td><td>121.59</td><td>23.81</td><td>29.86</td><td>3.41</td></tr><tr><td>2020/8/10 06:29</td><td>120.57</td><td>22.18</td><td>43.54</td><td>3.02</td></tr><tr><td>2020/8/10 06:14</td><td>121.7</td><td>22.17</td><td>124.78</td><td>4.13</td></tr><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p>Also see <a href=https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_library/#station-list-formatting-checkstation>checkstation.m</a> and <a href=https://CGRG-lab.github.io/doc-archive/docs/magtip/doc_library/#earthquake-catalog-formatting-checkcatalog>checkcatalog.m</a>.</p><h3 id=standard-data-format>Standard data format</h3><p>All records should be converted/transformed into the formatted matfiles.
The formatted file name is generated via <code>standarddataname</code>, where</p><div class=markdown><p><code>[fname] = standarddataname(stnm, dtstr, type_j)</code> returns the file name of the standard data format. For example, <code>standarddataname('HUAL', '20120202', 'GEMS0')</code> returns <code>stn[HUAL]dt[20120202]type[GEMS0].mat</code>.</p></div><p>The formatted matfile should contain only 1 field where the field name can be arbitrarily chosen. Saying the field to be <code>M</code>, <code>M</code> has to be a matrix where the column indices to time and data are assigned by function <code>fmt.colindex2data</code> depending on the type of the data. See <a href=../doc_library/#format>Library/Format</a> for more information.</p><h4 id=format-of-geomagnetic-data>Format of Geomagnetic Data</h4><p>All original files of geomagnetic timeseries have to be converted to the new format before any function that takes <code>dir_data</code> as an input argument.
You can convert the data by simply applying:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#000>conv_geomagdata</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_originalfiles</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dir_data</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>In which,</p><ul><li><code>conv_geomagdata</code> takes two required input argument. The first is the directory of original files, and the second is the output folder for the new files.</li><li>The naming of original files should be &ldquo;yyyymmdd.StationCode&rdquo; or &ldquo;yyyymmddHH.StationCode&rdquo;. For example, &ldquo;20150202.MS&rdquo; and &ldquo;2015020223.MS&rdquo;, respectively.</li><li>The naming criteria for new files is &ldquo;stn[StationCode]dt[yyyymmdd]type[DataType].mat&rdquo;. For example, &ldquo;stn[MS]dt[20150202]type[full].mat&rdquo; is the formatted geomagnetic data converted from &ldquo;20150202.MS&rdquo;, which is a one-component time series.</li><li>The process of conversion may take very long if the number of files to be converted is large. Use the option <code>'ContinueFromLast'</code> and <code>'FilterByDatetime'</code> to avoid repeatedly converting the files that have already been converted before.</li><li>For more information, see &ldquo;conv_geomagdata.m&rdquo;.</li></ul><h2 id=the-main-process>The Main Process</h2><p>After all data are prepared (those in <code>dir_data</code> and <code>dir_spreadsheet</code>), you can run the whole forecasting process simply with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#000>statind</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_data</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_stat</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>% For multi-threading, use statind_parfor(...) </span>
</span></span><span style=display:flex><span><span style=color:#000>anomalyind</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_stat</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_tsAIN</span><span style=color:#000;font-weight:700>);</span> 
</span></span><span style=display:flex><span><span style=color:#000>molscore</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_tsAIN</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_catalog</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_molchan</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>% For multi-threading, use molscore_parfor(...)</span>
</span></span><span style=display:flex><span><span style=color:#000>molscore3</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_tsAIN</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_molchan</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_catalog</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_jointstation</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>%For multi-threading, use molscore3_parfor(...) </span>
</span></span></code></pre></div><p>In which, <code>statind</code> calculates specific statistical quantities of each day; <code>anomalyind</code> calculates anomaly index according to different $A_\text{thr}$ threshold; <code>molscore</code> gives optimized models; and <code>molscore3</code> use optimized models to calculate probability forecasts.</p><h2 id=visualization-of-the-results>Visualization of the Results</h2><p>There are several tools provided for visualizing the result. For detailed information about these tools, please refer to the <a href=../doc_library/#plotting>Library/Tools/Plotting</a>.</p><p>There is also a script <strong>&ldquo;demo/demo_visualization.m&rdquo;</strong>; you can easily obtain plots of the results following the steps below:</p><ul><li>switch current directory to the folder named &ldquo;MagTIP-2022&rdquo;</li><li>run section(s) in the script"</li></ul><h3 id=probability-forecast>Probability Forecast</h3><p><code>plotProbability</code> visualizes the probability of the calculated results (which is stored in <code>dir_jointstation</code> in default), with options for whether to plot epicenters of target events (目標地震) and for specifying the date time to plot, as an example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#000>dir_prob</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>fullfile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_jointstation</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;png&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;prob&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>dates2plot</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>datetime</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2020</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>):</span><span style=color:#000>calmonths</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>):</span><span style=color:#000>datetime</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)];</span>
</span></span><span style=display:flex><span><span style=color:#000>plotProbability</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_jointstation</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_catalog</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_prob</span><span style=color:#000;font-weight:700>,</span><span style=color:#8f5902;font-style:italic>...</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#39;TimeRange&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dates2plot</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;PlotEpicenter&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;all&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p><img src=plotProb_ex1.png alt></p><blockquote><p>In this figure, the triangle denotes the location of station; circle(s) around each station denote the maximum and minimum range of detection ($R_C$) of the models that are responsible for calculating the TIPs; the filled color of the triangle denotes the ratio of valid models of the day; and hollow triangle denotes the station that cannot provide TIP for the day.</p></blockquote><h3 id=the-matching-diagram>The Matching Diagram</h3><p><code>plotEQKTIP1</code> provides the 1-dimensional match diagram of a specific model.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#000>dir_png</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>fullfile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_molchan</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;png&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;EQKTIP&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>plotEQKTIP1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dir_tsAIN</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_molchan</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_catalog</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>dir_png</span><span style=color:#000;font-weight:700>,</span><span style=color:#8f5902;font-style:italic>...</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#39;ForecastingPhase&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>calyears</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#4e9a06>&#39;ShowTrainingPhase&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;Rank&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span><span style=color:#8f5902;font-style:italic>...</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#39;ForceMagnitude&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#39;scatter&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p><img src=plotEQKTIP_ex1.png alt></p><blockquote><p>In this figure, the match diagram of EQK and TIP defined by the model of first rank is demonstrated. The intervals of black color denotes the days where there is no data in $T_\text{obs}$ at all (i.e. this model is invalid at these time) and hence TIP cannot be calculated.</p></blockquote><div class=section-index></div><div class="text-muted mt-5 pt-3 border-top">Last modified May 3, 2022: <a href=https://github.com/CGRG-lab/doc-archive/commit/5e05f349dbc5684074305eefa7eea785465e3323>update magtip (5e05f34)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 CGRG All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script>
<script src=/doc-archive/js/tabpane-persist.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css integrity=sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js integrity=sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/mhchem.min.js integrity=sha384-LIgAiYlGSAdpNC9+YDjDPF6JeS/RRIumtNo0CmyQERZ/+g0h9MbuYQwf/5pQ4Y4M crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{display:!1,left:"$",right:"$"},{display:!0,left:"$$",right:"$$"}]})'></script>
<script src=/doc-archive/js/main.min.cc069f17a2f2afe7152bcafc220ad2b2ace2198673cc8b533342fe93b898ad2e.js integrity="sha256-zAafF6Lyr+cVK8r8IgrSsqziGYZzzItTM0L+k7iYrS4=" crossorigin=anonymous></script></body></html>